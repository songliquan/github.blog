
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>网络编程 | Bloging</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Mr Song">
    

    
    <meta name="description" content="网络基本概念
客户端：client
服务器：server
请求:request
响应:response
过程
客户端 -&amp;gt; 发送请求 -&amp;gt; 服务器(连接数据库)
服务器 -&amp;gt; 发送响应 -&amp;gt; 客户端


客户端(移动端)
前段（前台）
iOS,Android


服务器(后端)
后台
Java、PHP、.NET
远程服务器-面向所有用户（上线）
本地服务器-面向公司内部（测">
<meta property="og:type" content="article">
<meta property="og:title" content="网络编程">
<meta property="og:url" content="http://yoursite.com/2013/03/08/网络编程/index.html">
<meta property="og:site_name" content="Bloging">
<meta property="og:description" content="网络基本概念
客户端：client
服务器：server
请求:request
响应:response
过程
客户端 -&amp;gt; 发送请求 -&amp;gt; 服务器(连接数据库)
服务器 -&amp;gt; 发送响应 -&amp;gt; 客户端


客户端(移动端)
前段（前台）
iOS,Android


服务器(后端)
后台
Java、PHP、.NET
远程服务器-面向所有用户（上线）
本地服务器-面向公司内部（测">
<meta property="og:image" content="http://yoursite.com/images/MIMEType.png">
<meta property="og:image" content="http://yoursite.com/images/查找警告对应的代号.gif">
<meta property="og:updated_time" content="2015-10-05T00:43:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="网络编程">
<meta name="twitter:description" content="网络基本概念
客户端：client
服务器：server
请求:request
响应:response
过程
客户端 -&amp;gt; 发送请求 -&amp;gt; 服务器(连接数据库)
服务器 -&amp;gt; 发送响应 -&amp;gt; 客户端


客户端(移动端)
前段（前台）
iOS,Android


服务器(后端)
后台
Java、PHP、.NET
远程服务器-面向所有用户（上线）
本地服务器-面向公司内部（测">

    
    <link rel="alternative" href="/atom.xml" title="Bloging" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Bloging" title="Bloging"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Bloging">Bloging</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/03/08/网络编程/" title="网络编程" itemprop="url">网络编程</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mr Song" target="_blank" itemprop="author">Mr Song</a>
		
  <p class="article-time">
    <time datetime="2013-03-08T00:43:13.000Z" itemprop="datePublished"> 发表于 2013-03-08</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#网络"><span class="toc-number">1.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-number">1.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP通信"><span class="toc-number">1.2.</span> <span class="toc-text">HTTP通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS中常用的HTTP请求方式"><span class="toc-number">1.3.</span> <span class="toc-text">iOS中常用的HTTP请求方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP_实践_-_NSURLConnection(了解即可)"><span class="toc-number">1.4.</span> <span class="toc-text">HTTP 实践 - NSURLConnection(了解即可)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简单登陆界面"><span class="toc-number">1.5.</span> <span class="toc-text">简单登陆界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析JSON"><span class="toc-number">1.6.</span> <span class="toc-text">解析JSON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOS中JSON解决方案"><span class="toc-number">1.7.</span> <span class="toc-text">IOS中JSON解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NSJSONSerialization"><span class="toc-number">1.7.1.</span> <span class="toc-text">NSJSONSerialization</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#苹果自带的movie播放器"><span class="toc-number">1.8.</span> <span class="toc-text">苹果自带的movie播放器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字典转模型框架"><span class="toc-number">1.9.</span> <span class="toc-text">字典转模型框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设计框架需要考虑的问题"><span class="toc-number">1.10.</span> <span class="toc-text">设计框架需要考虑的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析XML"><span class="toc-number">1.11.</span> <span class="toc-text">解析XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSXMLParser"><span class="toc-number">1.12.</span> <span class="toc-text">XSXMLParser</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#格式化服务器返回的JSON数据"><span class="toc-number">1.12.1.</span> <span class="toc-text">格式化服务器返回的JSON数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDataXML"><span class="toc-number">1.13.</span> <span class="toc-text">GDataXML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#多值参数"><span class="toc-number">1.13.1.</span> <span class="toc-text">多值参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解决输出到控制台显示中文乱码的问题"><span class="toc-number">1.14.</span> <span class="toc-text">解决输出到控制台显示中文乱码的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#文件下载"><span class="toc-number">2.</span> <span class="toc-text">文件下载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#小文件下载"><span class="toc-number">2.1.</span> <span class="toc-text">小文件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大文件下载"><span class="toc-number">2.2.</span> <span class="toc-text">大文件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解压缩"><span class="toc-number">2.3.</span> <span class="toc-text">解压缩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件上传"><span class="toc-number">2.4.</span> <span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取MIMEType"><span class="toc-number">2.5.</span> <span class="toc-text">获取MIMEType</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSOutputStream"><span class="toc-number">2.6.</span> <span class="toc-text">NSOutputStream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSURLConnection和NSRunLoop"><span class="toc-number">2.7.</span> <span class="toc-text">NSURLConnection和NSRunLoop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSURLSession"><span class="toc-number">2.8.</span> <span class="toc-text">NSURLSession</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET"><span class="toc-number">2.8.1.</span> <span class="toc-text">GET</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST"><span class="toc-number">2.8.2.</span> <span class="toc-text">POST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载"><span class="toc-number">2.8.3.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代理方式"><span class="toc-number">2.8.4.</span> <span class="toc-text">代理方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#断点下载"><span class="toc-number">2.9.</span> <span class="toc-text">断点下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSURLSession_上传文件"><span class="toc-number">2.10.</span> <span class="toc-text">NSURLSession 上传文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AFNetworking"><span class="toc-number">2.11.</span> <span class="toc-text">AFNetworking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手机联网状态"><span class="toc-number">2.12.</span> <span class="toc-text">手机联网状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MD5加密"><span class="toc-number">2.13.</span> <span class="toc-text">MD5加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPS"><span class="toc-number">2.14.</span> <span class="toc-text">HTTPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIWebView"><span class="toc-number">2.15.</span> <span class="toc-text">UIWebView</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS介绍"><span class="toc-number">2.16.</span> <span class="toc-text">JS介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML5"><span class="toc-number">2.16.1.</span> <span class="toc-text">HTML5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OC执行JS"><span class="toc-number">2.17.</span> <span class="toc-text">OC执行JS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS执行OC"><span class="toc-number">2.18.</span> <span class="toc-text">JS执行OC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#程序崩溃处理"><span class="toc-number">2.19.</span> <span class="toc-text">程序崩溃处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#去除Xcode编译警告"><span class="toc-number">2.20.</span> <span class="toc-text">去除Xcode编译警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异常处理"><span class="toc-number">2.21.</span> <span class="toc-text">异常处理</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="网络">网络</h1><h2 id="基本概念">基本概念</h2><ul>
<li>客户端：client</li>
<li>服务器：server</li>
<li>请求:request</li>
<li>响应:response</li>
<li>过程<ul>
<li>客户端 -&gt; 发送请求 -&gt; 服务器(连接数据库)</li>
<li>服务器 -&gt; 发送响应 -&gt; 客户端</li>
</ul>
</li>
<li>客户端(移动端)<ul>
<li>前段（前台）</li>
<li>iOS,Android</li>
</ul>
</li>
<li>服务器(后端)<ul>
<li>后台</li>
<li>Java、PHP、.NET</li>
<li>远程服务器-面向所有用户（上线）</li>
<li>本地服务器-面向公司内部（测试）</li>
</ul>
</li>
<li>URL<ul>
<li>URL的全称是Uniform Resource Locator（统一资源定位符）</li>
<li>通过1个URL，能找到互联网上唯一的1个资源</li>
<li>URL就是资源的地址、位置，互联网上的每个资源都有一个唯一的URL</li>
<li>URL的基本格式 = 协议://主机地址/路径</li>
</ul>
</li>
<li>URL中常见协议<ul>
<li><strong>HTTP</strong> - 网络所有资源（<a href="http://）这个最常用" target="_blank" rel="external">http://）这个最常用</a></li>
<li>file - 本机资源（file://）</li>
<li>mailto - 邮件地址 (mailto:)</li>
<li>FTP - 网络文件资源 （ftp://）</li>
</ul>
</li>
</ul>
<h2 id="HTTP通信">HTTP通信</h2><ul>
<li>http的作用是统一客户端和服务器的数据交换格式，使得彼此可以理解。</li>
<li>优点<ul>
<li>简单快速，服务器规模小，通信速度快</li>
<li>灵活，允许传输任意类型的数据</li>
<li>HTTP 0.9和1.0使用短连接方式（非持续连接）：每次连接只处理一个请求，服务器做出响应后，马上断开连接。</li>
</ul>
</li>
</ul>
<h2 id="iOS中常用的HTTP请求方式">iOS中常用的HTTP请求方式</h2><ul>
<li>原生<ul>
<li><code>NSURLConnection</code> - 最古老的方案</li>
<li><code>NSURLSession</code> - iOS7推出的新技术</li>
<li><code>CFNetworking</code> - NSURL的底层，纯C语言</li>
</ul>
</li>
<li>第三方框架<ul>
<li><code>ASIHttpRequest</code> - 外号“HTTP终结者”，功能强大，可惜已经停止更新</li>
<li><code>AFNetworking</code> - 维护使用者多</li>
<li><code>MKNetworkKit</code> - 印度，维护使用者少</li>
</ul>
</li>
<li>HTTP 请求<ul>
<li>HTTP/1.1 中定义了8种方法</li>
<li><strong>GET</strong>、<strong>POST</strong>、OPTIONS、HEAD、PUT、DELETE、TRACE、CONNECT、PATCH</li>
<li>最常用的就是GET、POST</li>
</ul>
</li>
</ul>
<h2 id="HTTP_实践_-_NSURLConnection(了解即可)">HTTP 实践 - <code>NSURLConnection</code>(了解即可)</h2><ul>
<li>HTTP同步请求</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 发送同步请求，会一直等待， 直到接收到数据</span></span><br><span class="line">- (<span class="keyword">void</span>)requestSynch</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1 创建请求连接</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.lala.com/login?username=123&amp;pwd=123"</span>];</span><br><span class="line">    <span class="comment">// 2 创建请求</span></span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url ];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSHTTPURLResponse</span> *response = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    <span class="comment">// 3 发送同步请求</span></span><br><span class="line">    <span class="comment">// endSynchronousRequest阻塞式的方法，等待服务器返回数据</span></span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request returningResponse:&amp;response error:&amp;error];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.解析服务器返回的数据（解析成字符串）</span></span><br><span class="line">    <span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc] initWithData:data encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--%@--%@-- %zd"</span>,str,response<span class="variable">.allHeaderFields</span>,response<span class="variable">.statusCode</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>HTTP异步请求</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 发送异步请求</span></span><br><span class="line">- (<span class="keyword">void</span>)requestAsync</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1 创建请求连接</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/login?username=123&amp;pwd=123"</span>];</span><br><span class="line">    <span class="comment">// 2 创建请求</span></span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url ];</span><br><span class="line">    <span class="comment">// 3 发送异步请求</span></span><br><span class="line">    [<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request queue:[[<span class="built_in">NSOperationQueue</span> alloc] init] completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *connectionError) &#123;</span><br><span class="line">        <span class="comment">// 4.解析服务器返回的数据（解析成字符串）</span></span><br><span class="line">        <span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc] initWithData:data encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="built_in">NSHTTPURLResponse</span> *httpRes = (<span class="built_in">NSHTTPURLResponse</span>* )response;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"--%@--%zd--%@--"</span>,str,httpRes<span class="variable">.statusCode</span>,httpRes<span class="variable">.allHeaderFields</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>HTTP代理请求模式<ul>
<li>协议：<code>NSURLConnectionDataDelegate</code></li>
<li>实现方法</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">    <span class="comment">// 1 创建请求连接</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/login?username=520it&amp;pwd=520it"</span>];</span><br><span class="line">    <span class="comment">// 2 创建请求</span></span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 代理请求模式,要遵守协议并实现代理方法</span></span><br><span class="line">    [<span class="built_in">NSURLConnection</span> connectionWithRequest:request delegate:<span class="keyword">self</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">///-----------------------------------------------------------------///</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 常用代理方法</span></span><br><span class="line"><span class="comment">// 接收服务器响应</span></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.localData</span> = [<span class="built_in">NSMutableData</span> data];</span><br><span class="line">     <span class="built_in">NSLog</span>(<span class="string">@"-didReceiveResponse-%zd"</span>,((<span class="built_in">NSHTTPURLResponse</span> *)response)<span class="variable">.statusCode</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接收到服务器的数据（如果数据量比较大，这个方法会被调用多次）</span></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.localData</span> appendData:data];</span><br><span class="line">      <span class="built_in">NSLog</span>(<span class="string">@"-didReceiveData-"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 完成数据下载</span></span><br><span class="line">- (<span class="keyword">void</span>)connectionDidFinishLoading:(<span class="built_in">NSURLConnection</span> *)connection</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc] initWithData:<span class="keyword">self</span><span class="variable">.localData</span> encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"-connectionDidFinishLoading-%@"</span>,str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 请求失败：请求超时等</span></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didFailWithError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">&#123;</span><br><span class="line">     <span class="built_in">NSLog</span>(<span class="string">@"-didFailWithError-"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简单登陆界面">简单登陆界面</h2><ul>
<li>GET请求</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)loginBtn:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取控件数据和网络数据进行比对</span></span><br><span class="line">    <span class="built_in">NSString</span> *userName = <span class="keyword">self</span><span class="variable">.userText</span><span class="variable">.text</span>;</span><br><span class="line">    <span class="keyword">if</span> (userName<span class="variable">.length</span> == <span class="number">0</span> ) &#123;</span><br><span class="line">        [SVProgressHUD showErrorWithStatus:<span class="string">@"用户名不能为空"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSString</span> *pwd = <span class="keyword">self</span><span class="variable">.pwdText</span><span class="variable">.text</span>;</span><br><span class="line">    <span class="keyword">if</span> (pwd<span class="variable">.length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        [SVProgressHUD showErrorWithStatus:<span class="string">@"密码不能为空"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示阴影</span></span><br><span class="line">    [SVProgressHUD showWithStatus:<span class="string">@"正在登陆中"</span> maskType:SVProgressHUDMaskTypeBlack];</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="built_in">NSString</span> *format = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"http://123.123.123.123/login?username=%@&amp;pwd=%@"</span>,userName,pwd];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,format);</span><br><span class="line">    <span class="comment">// 1 创建请求连接</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:format];</span><br><span class="line">    <span class="comment">// 2 创建请求</span></span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 发送异步请求</span></span><br><span class="line">    [<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request queue:[[<span class="built_in">NSOperationQueue</span> alloc] init] completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *connectionError) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// JSON:&#123;"success":"登录成功"&#125;</span></span><br><span class="line">        <span class="comment">// 4.解析服务器返回的数据（解析成字符串）</span></span><br><span class="line">        <span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc] initWithData:data encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="comment">// 对字符串进行分割</span></span><br><span class="line">        <span class="built_in">NSInteger</span> loc = [str rangeOfString:<span class="string">@"\":\""</span>]<span class="variable">.location</span> + <span class="number">3</span>;</span><br><span class="line">        <span class="built_in">NSInteger</span> len = [str rangeOfString:<span class="string">@"\"&#125;"</span>]<span class="variable">.location</span> - loc;</span><br><span class="line">        <span class="built_in">NSString</span> *result = [str substringWithRange:<span class="built_in">NSMakeRange</span>(loc, len)];</span><br><span class="line">        <span class="comment">// 显示结果</span></span><br><span class="line">        <span class="keyword">if</span> ([result containsString:<span class="string">@"success"</span>]) &#123;</span><br><span class="line">            [SVProgressHUD showSuccessWithStatus:result];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            [SVProgressHUD showErrorWithStatus:result];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>POST请求</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">   <span class="built_in">NSString</span> *format = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"http://123.123.123.123/login"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 创建请求连接</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:format];</span><br><span class="line">    <span class="comment">// 2 创建请求</span></span><br><span class="line">    <span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更改请求方法</span></span><br><span class="line">    request<span class="variable">.HTTPMethod</span> = <span class="string">@"POST"</span>;</span><br><span class="line">    <span class="comment">// 设置请求体</span></span><br><span class="line">    request<span class="variable">.HTTPBody</span> = [<span class="string">@"username=520it&amp;pwd=520it"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    <span class="comment">// 设置超时</span></span><br><span class="line">    request<span class="variable">.timeoutInterval</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// 设置请求头</span></span><br><span class="line"><span class="comment">//    [request setValue:@"ios9.0" forHTTPHeaderField:@"User-agent"];</span></span><br><span class="line">    <span class="comment">// 3 发送请求</span></span><br><span class="line">    [<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request queue:[<span class="built_in">NSOperationQueue</span> mainQueue] completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *connectionError) &#123;</span><br><span class="line">        <span class="keyword">if</span> (connectionError) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[[<span class="built_in">NSString</span> alloc] initWithData:data encoding:<span class="built_in">NSUTF8StringEncoding</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>路径中有汉字的话必须进行转换</strong></li>
<li>GET:手动转换</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">format = [format stringByAddingPercentEscapesUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li>POST:在设置请求体时直接设置了编码格式，会自动转换</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置请求体</span></span><br><span class="line">    request<span class="variable">.HTTPBody</span> = [<span class="string">@"username=小码哥&amp;pwd=520it"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br></pre></td></tr></table></figure>
<h2 id="解析JSON">解析JSON</h2><ul>
<li>服务器返回给客户端的数据一般都是JSON或者XML</li>
<li>JSON的格式很像OC中的字典和数组<ul>
<li>{“name” : “jack”, “age” : 10}</li>
<li>{“names” : [“jack”, “rose”, “jim”]}</li>
</ul>
</li>
<li>标准JSON格式的注意点：key必须用双引号</li>
<li>JSON和OC的对应关系</li>
</ul>
<table>
<thead>
<tr>
<th>JSON</th>
<th>OC</th>
</tr>
</thead>
<tbody>
<tr>
<td>{ }</td>
<td>字典 NSDictionry</td>
</tr>
<tr>
<td>[]</td>
<td>数组 NSArray</td>
</tr>
<tr>
<td>“ ”</td>
<td>字符串 NSString</td>
</tr>
<tr>
<td>10,10.4</td>
<td>NSNumber</td>
</tr>
</tbody>
</table>
<h2 id="IOS中JSON解决方案">IOS中JSON解决方案</h2><ul>
<li>第三方<ul>
<li>JSONKit、SBJson、TouchJSON（性能从左到右，越差）</li>
</ul>
</li>
<li>苹果原生（自带）：NSJSONSerialization（性能最好）</li>
</ul>
<h3 id="NSJSONSerialization">NSJSONSerialization</h3><ul>
<li>解析JSON</li>
<li>data转JSON</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)JSONObjectWithData:(<span class="built_in">NSData</span> *)data options:(<span class="built_in">NSJSONReadingOptions</span>)opt error:(<span class="built_in">NSError</span> **)error;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// data转JSON</span></span><br><span class="line">        <span class="built_in">NSString</span> *str = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:kNilOptions</span><br></pre></td></tr></table></figure>
<ul>
<li>JSON转data</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">+ (<span class="built_in">NSData</span> *)dataWithJSONObject:(<span class="keyword">id</span>)obj options:(<span class="built_in">NSJSONWritingOptions</span>)opt error:(<span class="built_in">NSError</span> **)error;</span><br></pre></td></tr></table></figure>
<ul>
<li>关于参数</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">NSJSONReadingOptions</span>) &#123;</span><br><span class="line">    <span class="built_in">NSJSONReadingMutableContainers</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">0</span>), <span class="comment">// 可变容器</span></span><br><span class="line">    <span class="built_in">NSJSONReadingMutableLeaves</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">1</span>), <span class="comment">// 子节点也是可变的，也就是说转换的所有数据都是可变的</span></span><br><span class="line">    <span class="built_in">NSJSONReadingAllowFragments</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">2</span>) <span class="comment">// 接收零散数据，比如说单个的‘10’，'false'</span></span><br><span class="line">&#125; <span class="built_in">NS_ENUM_AVAILABLE</span>(<span class="number">10</span>_7, <span class="number">5</span>_0);</span><br></pre></td></tr></table></figure>
<ul>
<li>参数<code>NSJSONReadingAllowFragments</code>使用如下</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 参数NSJSONReadingAllowFragments 用来读取单个元素</span></span><br><span class="line"><span class="built_in">NSString</span> *str  = <span class="string">@"10"</span>;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:[str dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>] options:<span class="built_in">NSJSONReadingAllowFragments</span> error:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"-- %@ --"</span>,data);</span><br></pre></td></tr></table></figure>
<ul>
<li>JSON转模型</li>
<li>每次都手动去转换的话，非常费时费力。可以使用第三方框架</li>
<li>MJExtension</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"> <span class="preprocessor">#import <span class="title">&lt;MJExtension.h&gt;</span></span></span><br><span class="line"><span class="comment">// 获得视频的模型数组</span></span><br><span class="line"><span class="keyword">self</span><span class="variable">.videos</span> = [SLQVideo objectArrayWithKeyValuesArray:dict[<span class="string">@"videos"</span>]];</span><br></pre></td></tr></table></figure>
<h2 id="苹果自带的movie播放器">苹果自带的movie播放器</h2><ul>
<li>只能播放有限的几种格式（mp4、mov等）</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 播放视频</span></span><br><span class="line"> <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123"</span>];</span><br><span class="line"> <span class="comment">// MPMoviePlayerViewController // 视图控制器</span></span><br><span class="line"> <span class="comment">// MPMoviePlayerController // 内部没有view，不能直接弹出</span></span><br><span class="line"> <span class="built_in">MPMoviePlayerViewController</span> *vc = [[<span class="built_in">MPMoviePlayerViewController</span> alloc] initWithContentURL:[url URLByAppendingPathComponent:video[<span class="string">@"url"</span>]]];</span><br><span class="line"> <span class="comment">// modal 出视频并播放</span></span><br><span class="line">  [<span class="keyword">self</span> presentViewController:vc animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<h2 id="字典转模型框架">字典转模型框架</h2><ul>
<li>Mantle<ul>
<li>所有模型都必须继承自MTModel</li>
</ul>
</li>
<li>JSONModel<ul>
<li>所有模型都必须继承自JSONModel</li>
</ul>
</li>
<li>MJExtension<ul>
<li>不需要强制继承任何其他类</li>
</ul>
</li>
</ul>
<h2 id="设计框架需要考虑的问题">设计框架需要考虑的问题</h2><ul>
<li>侵入性<ul>
<li>侵入性大就意味着很难离开这个框架</li>
</ul>
</li>
<li>易用性<ul>
<li>比如少量代码实现N多功能</li>
</ul>
</li>
<li>扩展性<ul>
<li>很容易给这个框架增加新框架</li>
</ul>
</li>
</ul>
<h2 id="解析XML">解析XML</h2><ul>
<li>XML解析方式<ul>
<li>SAX：逐行解释</li>
<li>DOM：一次性加载到内存</li>
</ul>
</li>
<li>苹果自带：NSXMLParser<ul>
<li>SAX 方式</li>
</ul>
</li>
<li>第三方库<ul>
<li>libxml2 ： 纯C语言，默认包含在iOS SDK  中，，同时支持SAX、DOM</li>
<li>GDataXML : DOM方式，由google开发，基于libxml2</li>
</ul>
</li>
<li>建议<ul>
<li>大文件 ： NSXMLParser、libxml2</li>
<li>小文件 ： GDataXML、XSXMLParser、libxml2</li>
</ul>
</li>
</ul>
<h2 id="XSXMLParser">XSXMLParser</h2><ul>
<li>使用过程<ul>
<li>1、设置源，初始化一个XSXMLParser对象</li>
<li>2、设置代理，实现代理方法</li>
<li>3、启动扫描</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化方法</span></span><br><span class="line">- (instancetype)initWithContentsOfURL:(<span class="built_in">NSURL</span> *)url;  <span class="comment">// initializes the parser with the specified URL.</span></span><br><span class="line">- (instancetype)initWithData:(<span class="built_in">NSData</span> *)data; <span class="comment">// create the parser from data</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用方法</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1 使用苹果的XML类解析xml文档</span></span><br><span class="line"><span class="built_in">NSXMLParser</span> *parser = [[<span class="built_in">NSXMLParser</span> alloc] initWithData:data];</span><br><span class="line">parser<span class="variable">.delegate</span> = <span class="keyword">self</span>; <span class="comment">// 2 设置代理</span></span><br><span class="line">[parser parse]; <span class="comment">// 3 启动扫描</span></span><br></pre></td></tr></table></figure>
<ul>
<li>主要是代理方法的使用</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"> <span class="preprocessor">#pragma mark -NSXMLParserDelegate代理方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文档开始</span></span><br><span class="line">- (<span class="keyword">void</span>)parserDidStartDocument:(<span class="built_in">NSXMLParser</span> *)parser</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//    NSLog(@"parserDidStartDocument");</span></span><br><span class="line"><span class="comment">//    self.videoArray = [NSMutableArray array];</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文档结束</span></span><br><span class="line">-  (<span class="keyword">void</span>)parserDidEndDocument:(<span class="built_in">NSXMLParser</span> *)parser</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//    NSLog(@"parserDidEndDocument--%@",self.videoArray);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始读取元素，attributes 参数表示要读取的元素</span></span><br><span class="line">- (<span class="keyword">void</span>)parser:(<span class="built_in">NSXMLParser</span> *)parser didStartElement:(<span class="built_in">NSString</span> *)elementName namespaceURI:(<span class="built_in">NSString</span> *)namespaceURI qualifiedName:(<span class="built_in">NSString</span> *)qName attributes:(<span class="built_in">NSDictionary</span> *)attributeDict&#123;</span><br><span class="line">    <span class="comment">//    NSLog(@"didStartElement---%@",attributeDict);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 所有的元素都会经过这里进行读取,包括根</span></span><br><span class="line">    <span class="comment">// 所以要进行判断，把根给排除</span></span><br><span class="line">    <span class="keyword">if</span> ([elementName isEqualToString:<span class="string">@"videos"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取模型数据，放入数组</span></span><br><span class="line">    SLQVideoItem *video = [SLQVideoItem objectWithKeyValues:attributeDict];</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.videoArray</span> addObject:video];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 读取元素结束</span></span><br><span class="line">- (<span class="keyword">void</span>)parser:(<span class="built_in">NSXMLParser</span> *)parser didEndElement:(<span class="built_in">NSString</span> *)elementName namespaceURI:(<span class="built_in">NSString</span> *)namespaceURI qualifiedName:(<span class="built_in">NSString</span> *)qName</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="格式化服务器返回的JSON数据">格式化服务器返回的JSON数据</h3><ul>
<li>在线格式化：<a href="http://tool.oschina.net/codeformat/json" target="_blank" rel="external">http://tool.oschina.net/codeformat/json</a></li>
<li>将服务器返回的字典或者数组写成plist文件</li>
</ul>
<h2 id="GDataXML">GDataXML</h2><ul>
<li>这个配置起来很麻烦<ul>
<li>首先不支持CocoaPods，所以只能手动拖拽进项目，而且项目比较旧。</li>
<li>然后进入工程设置 <code>Header Search Paths</code> 添加<code>/usr/include/libxml2</code></li>
<li>设置工程 <code>Other Linker Flags contain</code> 添加 <code>-lxml2</code></li>
<li>改变文件的编译方式为非ARC - <code>-fno -objc -arc</code></li>
<li>最后编译才不会出错</li>
</ul>
</li>
<li>使用过程<ul>
<li>GDataXMLDocument - 整个文档</li>
<li>GDataXMLElement - xml中某个元素</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1 使用GDataXML解析xml文件</span></span><br><span class="line">GDataXMLDocument *doc = [[GDataXMLDocument alloc] initWithData:data options:<span class="number">0</span> error:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 2 获取所有video元素，首先要获得根节点</span></span><br><span class="line"><span class="built_in">NSArray</span> *elements = [doc<span class="variable">.rootElement</span> elementsForName:<span class="string">@"video"</span>];</span><br><span class="line"><span class="comment">// 3 遍历所有元素</span></span><br><span class="line"><span class="keyword">for</span> (GDataXMLElement *ele <span class="keyword">in</span> elements) &#123;</span><br><span class="line">    SLQVideoItem *video  = [[SLQVideoItem alloc] init];</span><br><span class="line">    <span class="comment">// 4 获取元素属性，转换成字符串</span></span><br><span class="line">    video<span class="variable">.name</span> = [[ele attributeForName:<span class="string">@"name"</span>] stringValue];</span><br><span class="line">    video<span class="variable">.image</span>  = [[ele attributeForName:<span class="string">@"image"</span>] stringValue];</span><br><span class="line">    video<span class="variable">.url</span> = [[ele attributeForName:<span class="string">@"url"</span>] stringValue];</span><br><span class="line">    video<span class="variable">.length</span> = [[[ele attributeForName:<span class="string">@"length"</span>] stringValue] intValue];</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.videoArray</span> addObject:video];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="多值参数">多值参数</h3><ul>
<li>同一个参数传如多个数据，逗号分隔</li>
<li>一个参数包括多个字典</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// NSURL *url = [NSURL URLWithString:@"http://123.123.123.123/weather?place=beijing&amp;place=shanghai"];</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/weather?place=beijing,shanghai"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="解决输出到控制台显示中文乱码的问题">解决输出到控制台显示中文乱码的问题</h2><ul>
<li>重写descriptionWithLocale方法,这二个方法会在转换JSON时自动调用。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSDictionary</span> (<span class="title">Log</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)descriptionWithLocale:(<span class="keyword">id</span>)locale</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#123;"weathers":[&#123;"city":"beijing,shanghai","status":"晴转多云"&#125;]&#125;\</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将这句话格式化输出</span></span><br><span class="line">    <span class="built_in">NSMutableString</span> *str =[<span class="built_in">NSMutableString</span> string];</span><br><span class="line">    [str appendString:<span class="string">@"&#123;\n"</span>];</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span> enumerateKeysAndObjectsUsingBlock:^(<span class="keyword">id</span> key, <span class="keyword">id</span> obj, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line">        <span class="comment">// 拼接字符串</span></span><br><span class="line">        [str appendFormat:<span class="string">@"\t%@"</span>,key];</span><br><span class="line">        [str appendString:<span class="string">@" : "</span>];</span><br><span class="line">        [str appendFormat:<span class="string">@"%@,\n"</span>,obj];</span><br><span class="line"></span><br><span class="line">    &#125;];</span><br><span class="line">    [str appendString:<span class="string">@"&#125;"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出最后一个逗号</span></span><br><span class="line">    <span class="built_in">NSRange</span> range = [str rangeOfString:<span class="string">@","</span> options:<span class="built_in">NSBackwardsSearch</span>];</span><br><span class="line">    <span class="keyword">if</span> (range<span class="variable">.location</span> != <span class="built_in">NSNotFound</span>) &#123;</span><br><span class="line"></span><br><span class="line">        [str deleteCharactersInRange:range];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> 2015-07-15 18:43:08.137 05-掌握-多值参数[65936:116425]</span><br><span class="line"> &#123;</span><br><span class="line">	weathers : [</span><br><span class="line">	&#123;</span><br><span class="line">	status : 晴转多云,</span><br><span class="line">	city : Beijing</span><br><span class="line"> &#125;,</span><br><span class="line">	&#123;</span><br><span class="line">	status : 晴转多云,</span><br><span class="line">	city : Shanghai</span><br><span class="line"> &#125;</span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSArray</span> (<span class="title">Log</span>)</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)descriptionWithLocale:(<span class="keyword">id</span>)locale</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 将这句话格式化输出</span></span><br><span class="line">    <span class="built_in">NSMutableString</span> *str =[<span class="built_in">NSMutableString</span> string];</span><br><span class="line">    [str appendString:<span class="string">@"[\n"</span>];</span><br><span class="line">    [<span class="keyword">self</span> enumerateObjectsUsingBlock:^(<span class="keyword">id</span> obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line">        [str appendFormat:<span class="string">@"\t%@,\n"</span>,obj];</span><br><span class="line">    &#125;];</span><br><span class="line">    [str appendString:<span class="string">@"\t]"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出最后一个逗号</span></span><br><span class="line">    <span class="built_in">NSRange</span> range = [str rangeOfString:<span class="string">@","</span> options:<span class="built_in">NSBackwardsSearch</span>];</span><br><span class="line">    <span class="keyword">if</span> (range<span class="variable">.location</span> != <span class="built_in">NSNotFound</span>) &#123;</span><br><span class="line"></span><br><span class="line">        [str deleteCharactersInRange:range];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h1 id="文件下载">文件下载</h1><h2 id="小文件下载">小文件下载</h2><ul>
<li><p>直接使用NSData下载</p>
<p>  <code>NSData *data = [NSData dataWithContentsOfURL:url];</code></p>
</li>
<li><p>使用NSURLConnection 异步连接</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/images/minion_13.png"</span>];</span><br><span class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];</span><br><span class="line">[<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request queue:[<span class="built_in">NSOperationQueue</span> mainQueue] completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *connectionError) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---%zd---"</span>,data<span class="variable">.length</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用NSURLConnection代理方式实现</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 建立连接</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/videos/minion_02.mp4"</span>];</span><br><span class="line">    [<span class="built_in">NSURLConnection</span> connectionWithRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:url] delegate:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveResponse:(<span class="built_in">NSHTTPURLResponse</span> *)response</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"didReceiveResponse:%@"</span>,response);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.data</span> = [<span class="built_in">NSMutableData</span> data];</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.movieCount</span> = [response<span class="variable">.allHeaderFields</span>[<span class="string">@"Content-Length"</span>] integerValue];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 缓存到内存</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.data</span> appendData:data];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CGFloat</span> progress = <span class="number">1.0</span> * <span class="keyword">self</span><span class="variable">.data</span><span class="variable">.length</span> / <span class="keyword">self</span><span class="variable">.movieCount</span>;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.progressView</span><span class="variable">.progress</span> = progress;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%f"</span>,progress * <span class="number">100</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)connectionDidFinishLoading:(<span class="built_in">NSURLConnection</span> *)connection</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 这里进行文件的保存,保存到cache里</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSString</span> *filePath = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>) lastObject];</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.data</span> writeToFile:[filePath stringByAppendingPathComponent:<span class="string">@"1.mp4"</span>] atomically:<span class="literal">YES</span>];</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.data</span> = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="大文件下载">大文件下载</h2><ul>
<li>使用NSURLConnection代理方式实现</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 接收到响应的时候：创建一个空的文件</span></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveResponse:(<span class="built_in">NSHTTPURLResponse</span> *)response</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取文件长度</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.movieCount</span> = [response<span class="variable">.allHeaderFields</span>[<span class="string">@"Content-Length"</span>] integerValue];</span><br><span class="line">    <span class="comment">// 创建一个空文件</span></span><br><span class="line">    [[<span class="built_in">NSFileManager</span> defaultManager] createFileAtPath:SLQFilePath contents:<span class="literal">nil</span> attributes:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 创建文件句柄</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.handle</span> = [<span class="built_in">NSFileHandle</span> fileHandleForWritingAtPath:SLQFilePath];</span><br><span class="line"> &#125;</span><br><span class="line"><span class="comment">// 接收到具体数据：马上把数据写入一开始创建好的文件</span></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 移动到文件末尾</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.handle</span> seekToEndOfFile];</span><br><span class="line">    <span class="comment">// 写入数据</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.handle</span> writeData:data];</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.currentCount</span> += data<span class="variable">.length</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> progress = <span class="number">1.0</span> * <span class="keyword">self</span><span class="variable">.currentCount</span> / <span class="keyword">self</span><span class="variable">.movieCount</span>;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.progressView</span><span class="variable">.progress</span> = progress;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%f"</span>,progress * <span class="number">100</span> );</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)connectionDidFinishLoading:(<span class="built_in">NSURLConnection</span> *)connection</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.movieCount</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 关闭文件</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.handle</span> closeFile];</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.handle</span> = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="解压缩">解压缩</h2><ul>
<li>解压缩使用第三方库<code>SSZipArchive</code></li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">   <span class="comment">// 1 使用指定文件，创建一个压缩文件</span></span><br><span class="line">   <span class="built_in">NSArray</span> *paths = @[</span><br><span class="line">                      <span class="string">@"/Users/song/Desktop/test/1.png"</span>,</span><br><span class="line">                      <span class="string">@"/Users/song/Desktop/test/2.png"</span>,</span><br><span class="line">                      <span class="string">@"/Users/song/Desktop/test/3.png"</span>,</span><br><span class="line">                      <span class="string">@"/Users/song/Desktop/test/4.png"</span>,</span><br><span class="line">                      <span class="string">@"/Users/song/Desktop/test/5.png"</span></span><br><span class="line">                      ];</span><br><span class="line">   [Main createZipFileAtPath:<span class="string">@"/Users/song/Desktop/test.zip"</span> withFilesAtPaths:paths];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 使用指定目录创建一个压缩文件</span></span><br><span class="line">   [Main createZipFileAtPath:<span class="string">@"/Users/song/Desktop/test121212.zip"</span> withContentsOfDirectory:<span class="string">@"/Users/song/Desktop/test"</span>];</span><br><span class="line">   <span class="comment">// 3 解压缩一个文件到指定目录</span></span><br><span class="line">   [Main unzipFileAtPath:<span class="string">@"/Users/song/Desktop/test.zip"</span> toDestination:<span class="string">@"/Users/song/Desktop"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="文件上传">文件上传</h2><p><img src="images/MIMEType.png" alt=""></p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一定要注意这个格式是固定的</span></span><br><span class="line"><span class="comment">/* 文件参数格式</span><br><span class="line"> --分割线\r\n</span><br><span class="line"> Content-Disposition: form-data; name="参数名"; filename="文件名"\r\n</span><br><span class="line"> Content-Type: 文件的MIMEType\r\n</span><br><span class="line"> \r\n</span><br><span class="line"> 文件数据</span><br><span class="line"> \r\n</span><br><span class="line"> */</span></span><br><span class="line"><span class="comment">// 文件上传</span></span><br><span class="line"><span class="comment">// 1、创建请求</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/upload"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url];</span><br><span class="line"><span class="comment">// 2、设置协议</span></span><br><span class="line">request<span class="variable">.HTTPMethod</span> = <span class="string">@"POST"</span>;</span><br><span class="line"><span class="comment">// 3、设置请求头</span></span><br><span class="line">[request setValue:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"multipart/form-data; boundary=%@"</span>,SLQBoundary] forHTTPHeaderField:<span class="string">@"Content-Type"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、设置请求体</span></span><br><span class="line"><span class="built_in">NSMutableData</span> *body = [<span class="built_in">NSMutableData</span> data];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置文件参数</span></span><br><span class="line"><span class="comment">// 设置边界</span></span><br><span class="line">[body appendData:SLQUTF(<span class="string">@"--"</span>)];</span><br><span class="line">[body appendData:SLQUTF(SLQBoundary)];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"><span class="comment">// 文件参数名</span></span><br><span class="line">[body appendData:SLQUTF([<span class="built_in">NSString</span>[] stringWithFormat:<span class="string">@"Content-Disposition: form-data; name=\"file\"; filename=\"1.png\""</span>])];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"><span class="comment">// 文件类型</span></span><br><span class="line">[body appendData:SLQUTF([<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Content-Type: image/png"</span>])];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"><span class="comment">// 文件内容</span></span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1"</span>];</span><br><span class="line">[body appendData:<span class="built_in">UIImagePNGRepresentation</span>(image)];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 非文件参数格式</span><br><span class="line"> --分割线\r\n</span><br><span class="line"> Content-Disposition: form-data; name="参数名"\r\n</span><br><span class="line"> \r\n</span><br><span class="line"> 参数值</span><br><span class="line"> \r\n</span><br><span class="line"> */</span></span><br><span class="line"><span class="comment">// 设置非文件参数</span></span><br><span class="line">[body appendData:SLQUTF(<span class="string">@"--"</span>)];</span><br><span class="line">[body appendData:SLQUTF(SLQBoundary)];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"></span><br><span class="line">[body appendData:SLQUTF([<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Content-Disposition: form-data; name=\"username\""</span>])];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"></span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line">[body appendData:SLQUTF(<span class="string">@"bulabulabula"</span>)];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 结束标记</span><br><span class="line"> --分割--线\r\n</span><br><span class="line"> \r\n</span><br><span class="line"> */</span></span><br><span class="line"><span class="comment">// 结束标记</span></span><br><span class="line">[body appendData:SLQUTF(<span class="string">@"--"</span>)];</span><br><span class="line">[body appendData:SLQUTF(SLQBoundary)];</span><br><span class="line">[body appendData:SLQUTF(<span class="string">@"--"</span>)];</span><br><span class="line">[body appendData:SLQEnter];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">request<span class="variable">.HTTPBody</span> = body;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request queue:[<span class="built_in">NSOperationQueue</span> mainQueue] completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *connectionError) &#123;</span><br><span class="line">    <span class="comment">//  这个方法会调用descriptionWithLocale方法，可以在这里解决输出到控制台显示中文乱码的问题</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:kNilOptions error:<span class="literal">nil</span>]);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="获取MIMEType">获取MIMEType</h2><ul>
<li>OC 方法</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)getMIMEType:(<span class="built_in">NSString</span> *)path</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> fileURLWithPath:path]];</span><br><span class="line">    <span class="built_in">NSURLResponse</span> *response = <span class="literal">nil</span>;</span><br><span class="line">    [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request returningResponse:&amp;response error:<span class="literal">nil</span>];</span><br><span class="line">        <span class="keyword">return</span> response<span class="variable">.MIMEType</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>c语言</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 要包含头文件MobileCoreServices.h</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)mimeTypeForFileAtPath:(<span class="built_in">NSString</span> *)path</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (![[<span class="built_in">NSFileManager</span> defaultManager] fileExistsAtPath:path]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CFStringRef</span> UTI = UTTypeCreatePreferredIdentifierForTag(kUTTagClassFilenameExtension, (__bridge <span class="built_in">CFStringRef</span>)[path pathExtension], <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">CFStringRef</span> MIMEType = UTTypeCopyPreferredTagWithClass (UTI, kUTTagClassMIMEType);</span><br><span class="line">    <span class="built_in">CFRelease</span>(UTI);</span><br><span class="line">    <span class="keyword">if</span> (!MIMEType) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">@"application/octet-stream"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (__bridge <span class="built_in">NSString</span> *)(MIMEType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="NSOutputStream">NSOutputStream</h2><ul>
<li>文件流,文件输出流，可以输出到内存、硬盘、NSData</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立连接</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/videos/minion_02.mp4"</span>];</span><br><span class="line">    [<span class="built_in">NSURLConnection</span> connectionWithRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:url] delegate:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 接收到响应的时候：创建一个空的文件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveResponse:(<span class="built_in">NSHTTPURLResponse</span> *)response</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取服务器那里给出的建议名字   response.suggestedFilename);</span></span><br><span class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>) lastObject] stringByAppendingPathComponent:response<span class="variable">.suggestedFilename</span>];</span><br><span class="line">    <span class="comment">// 创建文件流</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.stream</span> = [[<span class="built_in">NSOutputStream</span> alloc] initToFileAtPath:path append:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 打开文件流</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.stream</span> open];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 接收到具体数据：马上把数据写入一开始创建好的文件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 参数1要求是bytes</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.stream</span> write:[data bytes]  maxLength:data<span class="variable">.length</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)connectionDidFinishLoading:(<span class="built_in">NSURLConnection</span> *)connection</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 关闭文件流</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.stream</span> close];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="NSURLConnection和NSRunLoop">NSURLConnection和NSRunLoop</h2><ul>
<li>使用NSURLConnection创建的请求，其内部和NSRunLoop有关联，必须保证NSRunLoop处于运行状态，否则代理方法运行起来就会出问题。</li>
<li>如果要在子线程里创建请求，必须要手动启动NSRunLoop，并且要在方法使用结束手动关闭NSRunLoop。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 建立连接</span></span><br><span class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/images/minion_05.png"</span>];</span><br><span class="line"><span class="built_in">NSURLConnection</span> *con = [<span class="built_in">NSURLConnection</span> connectionWithRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:url] delegate:<span class="keyword">self</span>];</span><br><span class="line"><span class="comment">// 决定代理方法在哪个队列中执行</span></span><br><span class="line">[con setDelegateQueue:[[<span class="built_in">NSOperationQueue</span> alloc] init]];</span><br><span class="line"><span class="comment">// 开启子线程runloop</span></span><br><span class="line"><span class="keyword">self</span><span class="variable">.runloop</span> =  <span class="built_in">CFRunLoopGetCurrent</span>();</span><br><span class="line"><span class="built_in">CFRunLoopRun</span>();</span><br></pre></td></tr></table></figure>
<p>在代理方法中使用完毕，停止runloop</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connectionDidFinishLoading:(<span class="built_in">NSURLConnection</span> *)connection</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--connectionDidFinishLoading--%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    <span class="built_in">CFRunLoopStop</span>(<span class="keyword">self</span><span class="variable">.runloop</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="NSURLSession">NSURLSession</h2><ul>
<li>这个是在iOS7之后推出的用于替代NSURLConnection的新类，<strong>推荐掌握这个</strong>。</li>
<li><code>NSURLSession</code> 主要由两部分组成，一个是Session实例对象，一个是任务。</li>
<li>使用步骤<ul>
<li>创建task（<code>dataTaskWithRequest</code>），启动task（<code>resume</code>）</li>
<li>抽象类,使用其子类（<code>NSURLSessionDataTask</code>、<code>NSURLSessionDownloadTask</code>、<code>NSURLSessionUploadTask</code>）</li>
<li>大小文件都一样，默认写入到tmp目录下面，下载完毕后要自己移动文件</li>
</ul>
</li>
<li><code>NSURLSession</code> 代理<ul>
<li>初始化时设置代理<code>&lt;NSURLSessionDataDelegate&gt;</code></li>
<li>实现过程<ul>
<li>接收响应，指定响应方式：取消、下载、变为下载 <code>didReceivedResponse</code></li>
<li>接收数据<code>didReceivedData</code></li>
<li>接收完毕（成功和失败都会进入这个方法）<code>didComplete</code></li>
</ul>
</li>
<li><strong>这个可以实现大文件下载</strong></li>
</ul>
</li>
<li>大文件断点下载<ul>
<li><code>NSURLSession</code> 的方法：<code>suspend、resume、cancel</code></li>
<li><code>resumeData</code> 保存暂停时程序数据状态,取消任务后要根据状态恢复下载</li>
<li>（不好 ，实现复杂）将下载的tmp文件保存到cachae，然后恢复现在时再从cache移动到临时文件</li>
<li>下载失败后要从NSError中获取失败时的恢复数据</li>
</ul>
</li>
<li>何为断点下载<ul>
<li>程序因意外事件终止，导致下载被停止，主要考虑用户突然关闭程序。</li>
<li>可以将下载的数据同步到沙盒中，并且记录下载大小，以及记录已下载的文件，每次下载之前都进行扫描一番。</li>
<li>如果下载一半就在请求头里指定要下载的范围</li>
</ul>
</li>
<li>上传<ul>
<li><code>NSURLSessionUploadTast</code></li>
<li>POST 请求设置注意<code>methodBody</code>为上传的参数<code>fromData</code></li>
<li><code>NSURLSessionConfiguration</code> 统一配置(比如可以在这里设置是否允许设置程序使用蜂窝移动网络)</li>
</ul>
</li>
</ul>
<h3 id="GET">GET</h3><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/login?username=123&amp;pwd=4324"</span>];</span><br><span class="line"><span class="comment">// 1 获得NSURLSession单例对象</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"><span class="comment">// 2 创建任务</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:url] completionHandler:^(<span class="built_in">NSData</span> *data, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">    <span class="comment">// 4 处理数据</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"----%@"</span>,[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:kNilOptions error:<span class="literal">nil</span>]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 3 启动任务</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure>
<h3 id="POST">POST</h3><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// post请求</span></span><br><span class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/login?username=123&amp;pwd=4324"</span>];</span><br><span class="line"><span class="comment">// 获得NSURLSession单例对象</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url];</span><br><span class="line"><span class="comment">// 设置请求头</span></span><br><span class="line">request<span class="variable">.HTTPMethod</span> = <span class="string">@"POST"</span>;</span><br><span class="line"><span class="comment">// 设置请求体</span></span><br><span class="line"><span class="built_in">NSMutableData</span> *body  = [<span class="built_in">NSMutableData</span> data];</span><br><span class="line">[body appendData:[<span class="string">@"username=123&amp;pwd=234"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line">request<span class="variable">.HTTPBody</span> = body;</span><br><span class="line"><span class="comment">// 创建任务</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request completionHandler:^(<span class="built_in">NSData</span> *data, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"----%@"</span>,[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:kNilOptions error:<span class="literal">nil</span>]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 启动任务</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure>
<h3 id="下载">下载</h3><ul>
<li>直接使用<code>downloadTaskWithURL:url</code>进行下载，不过下载成功的文件是放在tmp临时目录里面的，一定要及时把文件给移出来。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/videos/minion_02.mp4"</span>];</span><br><span class="line"><span class="comment">// 获得NSURLSession单例对象</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"><span class="comment">// 创建任务</span></span><br><span class="line"><span class="built_in">NSURLSessionDownloadTask</span> *task = [session downloadTaskWithURL:url completionHandler:^(<span class="built_in">NSURL</span> *location, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *filePath = [[<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>) lastObject] stringByAppendingPathComponent:response<span class="variable">.suggestedFilename</span>];</span><br><span class="line">    <span class="comment">// 这个方式下载的文件在tmp文件夹下，要把下载的文件移动到cache中永久保存,参数是 fileURLWithPath，看清了</span></span><br><span class="line">    <span class="comment">// loaction 表示在本地临时存储区的路径</span></span><br><span class="line">    [[<span class="built_in">NSFileManager</span> defaultManager] moveItemAtURL:location toURL:[<span class="built_in">NSURL</span> fileURLWithPath:filePath] error:<span class="literal">nil</span>];</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 启动任务</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure>
<h3 id="代理方式">代理方式</h3><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/videos/minion_02.mp4"</span>];</span><br><span class="line">    <span class="comment">// 创建</span></span><br><span class="line">    <span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:[<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration] delegate:<span class="keyword">self</span> delegateQueue:[[<span class="built_in">NSOperationQueue</span> alloc] init]];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建任务</span></span><br><span class="line">    <span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithURL:url];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动任务</span></span><br><span class="line">    [task resume];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收服务器响应，必须手动执行后续的执行方式（允许接收数据还是不允许接收）</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionResponseDisposition</span>))completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 必须手动指定接下来的数据要不要接收</span></span><br><span class="line">    completionHandler(<span class="built_in">NSURLSessionResponseAllow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接收数据，多次调用</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下载完毕后调用，如果失败，看参数error的值</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session task:(<span class="built_in">NSURLSessionTask</span> *)task didCompleteWithError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSURLSessionResponseDisposition</span>) &#123;</span><br><span class="line">    <span class="built_in">NSURLSessionResponseCancel</span> = <span class="number">0</span>,<span class="comment">/* Cancel the load, this is the same as -[task cancel] */</span></span><br><span class="line">    <span class="built_in">NSURLSessionResponseAllow</span> = <span class="number">1</span>,<span class="comment">/* Allow the load to continue */</span></span><br><span class="line">    <span class="built_in">NSURLSessionResponseBecomeDownload</span> = <span class="number">2</span>,<span class="comment">/* Turn this request into a download */</span></span><br><span class="line">&#125; <span class="built_in">NS_ENUM_AVAILABLE</span>(<span class="built_in">NSURLSESSION_AVAILABLE</span>, <span class="number">7</span>_0);</span><br></pre></td></tr></table></figure>
<h2 id="断点下载">断点下载</h2><ul>
<li>通过自定义<code>NSURLSession</code> ，使用dataWithTask来进行下载，并且手动控制器下载文件的去向。</li>
<li>每次下载之前都要去沙盒读取已下载的文件，用于判断从哪里进行下载</li>
<li>主要方法如下：</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataTask) &#123;</span><br><span class="line">        <span class="comment">// 获取下载进度，直接从沙盒中读取文件长度</span></span><br><span class="line">        <span class="built_in">NSInteger</span> total = [[<span class="built_in">NSMutableDictionary</span> dictionaryWithContentsOfFile:SLQDownloadFilePath][SLQFileName] integerValue];</span><br><span class="line">        <span class="built_in">NSInteger</span> current = [[[<span class="built_in">NSFileManager</span> defaultManager] attributesOfItemAtPath:SLQFilePath error:<span class="literal">nil</span>][<span class="built_in">NSFileSize</span>] integerValue];</span><br><span class="line">        <span class="keyword">if</span> (total &amp;&amp; total == current ) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"已经下载完毕"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果长度和</span></span><br><span class="line">        <span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/videos/minion_02.mp4"</span>];</span><br><span class="line">        <span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url];</span><br><span class="line">        <span class="comment">// 指定要从服务器获取的数据的范围</span></span><br><span class="line">        <span class="built_in">NSString</span> *range = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"bytes=%zd-"</span>,current];</span><br><span class="line"></span><br><span class="line">        [request setValue:range forHTTPHeaderField:<span class="string">@"Range"</span>];</span><br><span class="line">        <span class="comment">// 创建任务</span></span><br><span class="line">        _dataTask = [<span class="keyword">self</span><span class="variable">.session</span> dataTaskWithRequest:request];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  _dataTask;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveResponse:(<span class="built_in">NSHTTPURLResponse</span> *)response completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionResponseDisposition</span>))completionHandler</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//    NSLog(@"----%@",[response class]);</span></span><br><span class="line">    <span class="comment">// 开启输出流</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.stream</span> open];</span><br><span class="line">    <span class="comment">// 计算总得数据长度，response会返回请求的数据长度，不包括已经下载的数据长度，所以要累加起来</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.totalCount</span> = [response<span class="variable">.allHeaderFields</span>[<span class="string">@"Content-Length"</span>] integerValue] + SLQFileLength;</span><br><span class="line">    <span class="built_in">NSString</span> *name = response<span class="variable">.suggestedFilename</span>;</span><br><span class="line">    <span class="comment">// 存储总长度,将所要下载的文件长度保存起来</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionaryWithContentsOfFile:SLQDownloadFilePath];</span><br><span class="line">    <span class="keyword">if</span> (dict == <span class="literal">nil</span>) &#123;</span><br><span class="line">        dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    &#125;</span><br><span class="line">    dict[SLQFileName] = @(<span class="keyword">self</span><span class="variable">.totalCount</span>);</span><br><span class="line">    [dict writeToFile:SLQDownloadFilePath atomically:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 继续下载</span></span><br><span class="line">    completionHandler(<span class="built_in">NSURLSessionResponseAllow</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 写入数据到沙盒</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.stream</span> write:[data bytes]maxLength:data<span class="variable">.length</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取下载进度，直接从沙盒中读取文件长度</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---%f"</span>,<span class="number">1.0</span> * SLQFileLength / <span class="keyword">self</span><span class="variable">.totalCount</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session task:(<span class="built_in">NSURLSessionTask</span> *)task didCompleteWithError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 清空</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.dataTask</span> = <span class="literal">nil</span>;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.stream</span> close];</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.stream</span> = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="NSURLSession_上传文件">NSURLSession 上传文件</h2><ul>
<li>必须按照格式写，一个空格或者回车都不能多。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一定要注意这个格式是固定的</span></span><br><span class="line"><span class="comment">/* 文件参数格式</span><br><span class="line"> --分割线\r\n</span><br><span class="line"> Content-Disposition: form-data; name="file"; filename="文件名"\r\n</span><br><span class="line"> Content-Type: 文件的MIMEType\r\n</span><br><span class="line"> \r\n</span><br><span class="line"> 文件数据</span><br><span class="line"> \r\n</span><br><span class="line"> // 结束标记</span><br><span class="line"> \r\n</span><br><span class="line"> --分割线--\r\n</span><br><span class="line"> \r\n</span><br><span class="line"> */</span></span><br><span class="line"> <span class="comment">// 主要是参数第二个参数要传入 **`请求体`**</span></span><br><span class="line">   [[<span class="keyword">self</span><span class="variable">.session</span> uploadTaskWithRequest:request fromData:body completionHandler:^(<span class="built_in">NSData</span> *data, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---%@"</span>,[<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:kNilOptions error:<span class="literal">nil</span>]);</span><br><span class="line">&#125;] resume];</span><br></pre></td></tr></table></figure>
<h2 id="AFNetworking">AFNetworking</h2><ul>
<li>GET\POST<ul>
<li><code>AFHTTPRequestManager</code></li>
<li><code>AFHTTPSessionManager</code></li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)GET</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// GET</span></span><br><span class="line">    AFHTTPSessionManager *mgr = [AFHTTPSessionManager manager];</span><br><span class="line">    <span class="comment">// 将数据作为参数传入</span></span><br><span class="line">    <span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">                           <span class="string">@"username"</span>:<span class="string">@"12"</span>,</span><br><span class="line">                           <span class="string">@"pwd"</span>:<span class="string">@"13"</span></span><br><span class="line">                           &#125;;</span><br><span class="line">    [mgr GET:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"http://123.123.123.123/login"</span>] parameters:dict success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"success:%@"</span>,responseObject);</span><br><span class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"failure:%@"</span>,error);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)POST</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// POST</span></span><br><span class="line">    AFHTTPSessionManager *mgr = [AFHTTPSessionManager manager];</span><br><span class="line">    <span class="comment">// 将数据作为参数传入</span></span><br><span class="line">    <span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">                           <span class="string">@"username"</span>:<span class="string">@"12"</span>,</span><br><span class="line">                           <span class="string">@"pwd"</span>:<span class="string">@"13"</span></span><br><span class="line">                           &#125;;</span><br><span class="line">    [mgr POST:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"http://123.123.123.123/login"</span>] parameters:dict success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"success:%@"</span>,responseObject);</span><br><span class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"failure:%@"</span>,error);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>文件上传：appendPartWithFileData:</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)upload</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 文件上传</span></span><br><span class="line">    AFHTTPSessionManager *mgr = [AFHTTPSessionManager manager];</span><br><span class="line">    <span class="comment">// 将数据作为参数传入</span></span><br><span class="line">    [mgr POST:<span class="string">@"http://123.123.123.123/upload"</span> parameters:<span class="literal">nil</span> constructingBodyWithBlock:^(<span class="keyword">id</span>&lt;AFMultipartFormData&gt; formData) &#123;</span><br><span class="line">        <span class="comment">// formdata 为要上传的数据</span></span><br><span class="line"><span class="comment">//        [formData appendPartWithFileURL:[NSURL fileURLWithPath:@"/Users/song/Desktop/test.png"] name:@"file" error:nil];</span></span><br><span class="line">        [formData appendPartWithFileData:[<span class="built_in">NSData</span> dataWithContentsOfFile:<span class="string">@"/Users/song/Desktop/test.png"</span>] name:<span class="string">@"file"</span> fileName:<span class="string">@"wer.png"</span> mimeType:<span class="string">@"image/png"</span>];</span><br><span class="line">    &#125; success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"success:%@"</span>,responseObject);</span><br><span class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"failure:%@"</span>,error);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>文件下载<ul>
<li>下载文件需要返回一个保存路径，还需要手动启动resume</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)download</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 下载</span></span><br><span class="line">    AFHTTPSessionManager *mgr = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line">    [[mgr downloadTaskWithRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://123.123.123.123/resources/images/minion_02.png"</span>]] progress:<span class="literal">nil</span> destination:^<span class="built_in">NSURL</span> *(<span class="built_in">NSURL</span> *targetPath, <span class="built_in">NSURLResponse</span> *response) &#123;</span><br><span class="line">        <span class="comment">// 下载文件需要返回一个保存路径，还需要手动启动resume</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">NSURL</span> fileURLWithPath:[path stringByAppendingPathComponent:response<span class="variable">.suggestedFilename</span>]];</span><br><span class="line">    &#125; completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSURL</span> *filePath, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,filePath<span class="variable">.path</span>);</span><br><span class="line">    &#125;] resume];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>默认是解析json，如果想解析xml，需要指定管理器的解析器为xml<ul>
<li>如果解析其他类型的文件，就将<code>responseSerializer</code>属性设置为<code>ADHTTPResonseSericlizer</code>，服务器返回什么就接受什么类型的数据。</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)returnType</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 默认返回的数据时JSON，如果想返回XML，设置属性responseSerializer</span></span><br><span class="line">    <span class="comment">// 如果想返回服务器上文件本来的类型，设置AFHTTPResponseSerializer</span></span><br><span class="line">    AFHTTPSessionManager *mgr = [AFHTTPSessionManager manager];</span><br><span class="line">    <span class="comment">// responseSerializer 用来解析服务器返回的数据</span></span><br><span class="line">    mgr<span class="variable">.responseSerializer</span> = [AFHTTPResponseSerializer serializer]; <span class="comment">// 直接使用“服务器本来返回的数据”，不做任何解析</span></span><br><span class="line">    <span class="comment">// 告诉AFN，以XML形式解析服务器返回的数据</span></span><br><span class="line">    <span class="comment">//    mgr.responseSerializer = [AFXMLParserResponseSerializer serializer];</span></span><br><span class="line">    <span class="comment">// 将数据作为参数传入</span></span><br><span class="line">    [mgr GET:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"http://123.123.123.123/resources/images/minion_02.png"</span>] parameters:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionDataTask</span> *task,<span class="keyword">id</span> response) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"success:%zd"</span>,[response length]);</span><br><span class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"failure:%@"</span>,error);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="手机联网状态">手机联网状态</h2><pre><code>-<span class="ruby"> 手机联网状态：<span class="string">`AFNetWorkReachabityManager`</span>
</span>-<span class="ruby"> 苹果自带：<span class="string">`Reachability`</span> ，通过通知监听系统状态</span>
</code></pre><ul>
<li>手机联网状态：<code>AFNetWorkReachabityManager</code></li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)monitor</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 监控网络状态</span></span><br><span class="line">    AFNetworkReachabilityManager *mgr  = [AFNetworkReachabilityManager sharedManager];</span><br><span class="line">    <span class="comment">// 网络状态改变就会调用这个block</span></span><br><span class="line">    [mgr setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"网络状态改变：%zd"</span>,status);</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="comment">// 打开监听器</span></span><br><span class="line">    [mgr startMonitoring];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    typedef NS_ENUM(NSInteger, AFNetworkReachabilityStatus) &#123;</span><br><span class="line">     AFNetworkReachabilityStatusUnknown          = -1, // 未知</span><br><span class="line">     AFNetworkReachabilityStatusNotReachable     = 0, // 未联网</span><br><span class="line">     AFNetworkReachabilityStatusReachableViaWWAN = 1, // 蜂窝网络</span><br><span class="line">     AFNetworkReachabilityStatusReachableViaWiFi = 2, // wifi</span><br><span class="line">     &#125;;</span><br><span class="line">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>手机联网状态：<code>Reachability</code><ul>
<li>手机的状态改变，会给系统发送通知，所以可以添加监听器，接收这个通知。</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**通知*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Reachability *reach;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 添加通知</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(getNetworkStatus) name:kReachabilityChangedNotification object:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 接收通知</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.reach</span> = [Reachability reachabilityForInternetConnection];</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.reach</span> startNotifier];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)getNetworkStatus</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     typedef enum : NSInteger &#123;</span><br><span class="line">     NotReachable = 0, // 网络不可知</span><br><span class="line">     ReachableViaWiFi, // WIFI</span><br><span class="line">     ReachableViaWWAN  // 移动网络</span><br><span class="line">     &#125; NetworkStatus;</span><br><span class="line">     */</span></span><br><span class="line">    <span class="comment">// 获取手机网络状态</span></span><br><span class="line">    <span class="keyword">if</span>([Reachability reachabilityForLocalWiFi]<span class="variable">.currentReachabilityStatus</span> != NotReachable)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"wifi"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>([Reachability reachabilityForInternetConnection]<span class="variable">.currentReachabilityStatus</span> != NotReachable)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"3G?4G"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Nothing at all!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 停止监听器</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.reach</span> startNotifier];</span><br><span class="line">    <span class="comment">// 移除通知</span></span><br><span class="line">      [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span> name:kReachabilityChangedNotification object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MD5加密">MD5加密</h2><ul>
<li>使用:主要是对用户的敏感信息进行加密<ul>
<li>对输入信息生成唯一的128位散列值（32个字符）</li>
<li>根据输出值，不能得到原始的明文，即其过程不可逆</li>
</ul>
</li>
<li>MD5改进<ul>
<li>加盐（Salt）：在明文的固定位置插入随机串，然后再进行MD5</li>
<li>先加密，后乱序：先对明文进行MD5，然后对加密得到的MD5串的字符进行乱序</li>
<li>等等，就是让信息更加复杂</li>
</ul>
</li>
</ul>
<h2 id="HTTPS">HTTPS</h2><ul>
<li><p>使用https要实现代理方法 <code>didReceiveChallenge</code></p>
</li>
<li><p>1 创建HTTPS链接</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">_dataTask = [<span class="keyword">self</span><span class="variable">.session</span> dataTaskWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://www.apple.com/"</span>] completionHandler:^(<span class="built_in">NSData</span> *data, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[<span class="built_in">NSString</span> alloc] initWithData:data encoding:<span class="built_in">NSUTF8StringEncoding</span>]);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>2 实现代理方法 <code>didReceiveChallenge</code></li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 代理方法</span><br><span class="line"> * challenge ： 挑战、质询</span><br><span class="line"> * completionHandler : 通过调用这个block，来告诉URLSession要不要接收这个证书</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session didReceiveChallenge:(<span class="built_in">NSURLAuthenticationChallenge</span> *)challenge completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionAuthChallengeDisposition</span>, <span class="built_in">NSURLCredential</span> *))completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// NSURLSessionAuthChallengeDisposition ： 如何处理这个安全证书</span></span><br><span class="line">    <span class="comment">// NSURLCredential ：安全证书</span></span><br><span class="line"><span class="comment">//    NSLog(@"%@",challenge);</span></span><br><span class="line">    <span class="keyword">if</span> (![challenge<span class="variable">.protectionSpace</span><span class="variable">.authenticationMethod</span> isEqualToString:<span class="built_in">NSURLAuthenticationMethodServerTrust</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(completionHandler)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 利用这个block说明使用这个证书</span></span><br><span class="line">        completionHandler(<span class="built_in">NSURLSessionAuthChallengeUseCredential</span>,challenge<span class="variable">.proposedCredential</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIWebView">UIWebView</h2><ul>
<li>显示网页数据</li>
<li>代理方法<code>&lt;UIWebViewDelegate&gt;</code><ul>
<li><code>shouldStartLoadWithRequest</code>: 请求之前判断是否允许访问(过滤某些网址)</li>
<li>属性UIScrollView可以控制滚动范围</li>
<li><code>loadHTMLString</code></li>
<li><code>loadData：</code></li>
<li>可以加载网络资源和本地资源</li>
<li><code>scalesPageToFit</code> 屏幕自适应</li>
<li><code>dataDetectorTypes</code> 自动检测网页中出现的电话号码，网址等，添加下划线和链接。</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 始发送请求（加载数据）时调用这个方法</span></span><br><span class="line">- (<span class="keyword">void</span>)webViewDidStartLoad:(<span class="built_in">UIWebView</span> *)webView;</span><br><span class="line"><span class="comment">// 请求完毕（加载数据完毕）时调用这个方法</span></span><br><span class="line">- (<span class="keyword">void</span>)webViewDidFinishLoad:(<span class="built_in">UIWebView</span> *)webView;</span><br><span class="line"><span class="comment">// 请求错误时调用这个方法</span></span><br><span class="line">- (<span class="keyword">void</span>)webView:(<span class="built_in">UIWebView</span> *)webView didFailLoadWithError:(<span class="built_in">NSError</span> *)error;</span><br><span class="line"><span class="comment">// UIWebView在发送请求之前，都会调用这个方法，如果返回NO，代表停止加载请求，返回YES，代表允许加载请求</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)webView:(<span class="built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="built_in">NSURLRequest</span> *)request navigationType:(<span class="built_in">UIWebViewNavigationType</span>)navigationType;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">* 每当webView即将发送一个请求之前，都会调用这个方法</span><br><span class="line">* 返回YES：允许加载这个请求</span><br><span class="line">* 返回NO：禁止加载这个请求</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)webView:(<span class="built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="built_in">NSURLRequest</span> *)request navigationType:(<span class="built_in">UIWebViewNavigationType</span>)navigationType&#123;</span><br><span class="line">     <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">    <span class="keyword">if</span> ([request<span class="variable">.URL</span><span class="variable">.absoluteString</span> containsString:<span class="string">@"life"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="JS介绍">JS介绍</h2><h3 id="HTML5">HTML5</h3><ul>
<li>html（内容） + CSS（样式） + JS（动态效果、事件交互）</li>
<li>常用JS函数<ul>
<li><code>-alert(10);  // 弹框</code></li>
<li><code>document.getElementById(‘test’); // 根据ID获得某个DOM元素</code></li>
</ul>
</li>
<li>JS和OC通信</li>
<li>oc执行js<ul>
<li><code>stringByEvaluatingJavaScriptFromString</code></li>
<li>JS 函数</li>
<li><code>function</code></li>
</ul>
</li>
<li>JS执行OC<ul>
<li>通过代理法方法 <code>shouldStartLoadWithRequest</code></li>
<li>在js函数中调用 <code>loaction.href = &#39;slq://sendMessage_?参数1&amp;参数2&#39;;</code></li>
<li>传递参数的话，在方法后边写入一符号（_、@等）标识要传递参数，然后参数之间也要加入符号分割</li>
</ul>
</li>
</ul>
<h2 id="OC执行JS">OC执行JS</h2><ul>
<li>是用OC执行那个JS脚本</li>
<li><code>stringByEvaluatingJavaScriptFromString</code></li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">[webView stringByEvaluatingJavaScriptFromString:<span class="string">@"alert(100)"</span>];</span><br><span class="line"><span class="comment">// 调用JS中的函数，</span></span><br><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[webView stringByEvaluatingJavaScriptFromString:<span class="string">@"login();"</span>]);</span><br><span class="line"> <span class="keyword">self</span><span class="variable">.title</span> = [webView stringByEvaluatingJavaScriptFromString:<span class="string">@"document.title;"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="JS执行OC">JS执行OC</h2><ul>
<li><p>通过代理法方法 shouldStartLoadWithRequest</p>
</li>
<li><p>无参数传递</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 通过这个方法完成JS调用OC</span><br><span class="line"> * JS和OC交互的第三方框架：WebViewJavaScriptBridge</span><br><span class="line"> */</span></span><br><span class="line"> <span class="comment">// location.href = 'slq://call';</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)webView:(<span class="built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="built_in">NSURLRequest</span> *)request navigationType:(<span class="built_in">UIWebViewNavigationType</span>)navigationType</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,request<span class="variable">.URL</span>);</span><br><span class="line">    <span class="built_in">NSString</span> *url = request<span class="variable">.URL</span><span class="variable">.absoluteString</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *pre = <span class="string">@"slq://"</span>;</span><br><span class="line">    <span class="keyword">if</span>([url hasPrefix:pre])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 调用OC方法</span></span><br><span class="line"><span class="comment">//        NSLog(@"调用OC方法");</span></span><br><span class="line">        <span class="built_in">NSString</span> *method = [url substringFromIndex:pre<span class="variable">.length</span>];</span><br><span class="line">        <span class="comment">// NSSelectorFromString 将字符串转换成方法名</span></span><br><span class="line">        [<span class="keyword">self</span> performSelector:<span class="built_in">NSSelectorFromString</span>(method) withObject:<span class="literal">nil</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    NSLog(@"发送请求");</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>2个参数<ul>
<li>使用’_’代替’:’,’？’区分参数和函数名，’&amp;’区分参数</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// location.href = 'slq://call2_number2_?&amp;100';</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)webView:(<span class="built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="built_in">NSURLRequest</span> *)request navigationType:(<span class="built_in">UIWebViewNavigationType</span>)navigationType</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *url = request<span class="variable">.URL</span><span class="variable">.absoluteString</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *pre = <span class="string">@"slq://"</span>;</span><br><span class="line">    <span class="keyword">if</span>([url hasPrefix:pre])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 调用OC方法</span></span><br><span class="line">        <span class="built_in">NSString</span> *method = [url substringFromIndex:pre<span class="variable">.length</span>];</span><br><span class="line">        <span class="comment">// method = call2_number2_?200&amp;300</span></span><br><span class="line">        <span class="comment">// 分割字符串</span></span><br><span class="line">        <span class="built_in">NSArray</span> *arr = [method componentsSeparatedByString:<span class="string">@"?"</span>];</span><br><span class="line">        <span class="comment">// call2:number2:</span></span><br><span class="line">        <span class="built_in">NSString</span> *methodName = [[arr firstObject] stringByReplacingOccurrencesOfString:<span class="string">@"_"</span> withString:<span class="string">@":"</span>];</span><br><span class="line">        <span class="comment">// 200&amp;300</span></span><br><span class="line">        <span class="built_in">NSString</span> *paramStr = [arr lastObject];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSArray</span> *params = <span class="literal">nil</span>;</span><br><span class="line">        <span class="keyword">if</span> (arr<span class="variable">.count</span> == <span class="number">2</span> &amp;&amp; [paramStr containsString:<span class="string">@"&amp;"</span>]) &#123;</span><br><span class="line">            params = [paramStr componentsSeparatedByString:<span class="string">@"&amp;"</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSString</span> *param1 = [params firstObject];</span><br><span class="line">        <span class="built_in">NSString</span> *param2 = params<span class="variable">.count</span> &lt;= <span class="number">1</span> ? <span class="literal">nil</span> : [params lastObject];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,methodName);</span><br><span class="line"></span><br><span class="line">        [<span class="keyword">self</span> performSelector:<span class="built_in">NSSelectorFromString</span>(methodName) withObject:param1 withObject:param2]; <span class="comment">// 两个参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        [self performSelector:NSSelectorFromString(methodName) withObject:para];// 一个参数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>3个参数<ul>
<li>如果有3个以上参数，只能使用方法签名的方式来确定传递参数</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)performSelector:(SEL)selector withObjects:(<span class="built_in">NSArray</span> *)params</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置方法签名</span></span><br><span class="line">    <span class="built_in">NSMethodSignature</span> *sig = [[<span class="keyword">self</span> class] instanceMethodSignatureForSelector:selector];</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">if</span> (sig == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"方法没找到"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// NSInvocation 包装对象利用一个NSInvocation对象包装一次方法调用（方法调用者、方法名、方法参数、方法返回值）</span></span><br><span class="line">    <span class="built_in">NSInvocation</span> *invo = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:sig];</span><br><span class="line">    invo<span class="variable">.target</span> = <span class="keyword">self</span>;</span><br><span class="line">    invo<span class="variable">.selector</span> = selector;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置参数</span></span><br><span class="line">    <span class="built_in">NSInteger</span> paramNum = sig<span class="variable">.numberOfArguments</span> - <span class="number">2</span>; <span class="comment">// 包含两个隐含参数：self and _cmd</span></span><br><span class="line">    <span class="comment">// 取最小值作为参数,</span></span><br><span class="line">    paramNum = MIN(paramNum, params<span class="variable">.count</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; paramNum; i ++) &#123;</span><br><span class="line">        <span class="keyword">id</span> obj = params[i];</span><br><span class="line">        <span class="keyword">if</span> ([obj isKindOfClass:[<span class="built_in">NSNull</span> class]]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        [invo setArgument:&amp;obj atIndex:i + <span class="number">2</span>]; <span class="comment">// 从第三个参数开始</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置回调</span></span><br><span class="line">    [invo invoke];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回值</span></span><br><span class="line">    <span class="keyword">id</span> returnVal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (sig<span class="variable">.methodReturnLength</span>) &#123;</span><br><span class="line">        [invo getReturnValue:&amp;returnVal];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="程序崩溃处理">程序崩溃处理</h2><ul>
<li>在appdelegate中判断</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> handleException(<span class="built_in">NSException</span> *exception)</span><br><span class="line">&#123;</span><br><span class="line">    [[<span class="built_in">UIApplication</span> sharedApplication]<span class="variable">.delegate</span> performSelector:<span class="keyword">@selector</span>(handle)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)handle</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIAlertView</span> *alertView = [[<span class="built_in">UIAlertView</span> alloc] initWithTitle:<span class="string">@"哈哈"</span> message:<span class="string">@"崩溃了把"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"好的"</span> otherButtonTitles:<span class="literal">nil</span>, <span class="literal">nil</span>];</span><br><span class="line">    [alertView show];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新启动RunLoop</span></span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:[<span class="built_in">NSPort</span> port] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)alertView:(<span class="built_in">UIAlertView</span> *)alertView clickedButtonAtIndex:(<span class="built_in">NSInteger</span>)buttonIndex</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"-------点击了好的"</span>);</span><br><span class="line">    exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置捕捉异常的回调</span></span><br><span class="line">    <span class="built_in">NSSetUncaughtExceptionHandler</span>(handleException);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="去除Xcode编译警告">去除Xcode编译警告</h2><ul>
<li>如果对于某些警告需要屏蔽，需要找到这个警告 的代号</li>
</ul>
<p><img src="images/查找警告对应的代号.gif" alt=""></p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 去除Xcode编译警告</span></span><br><span class="line"><span class="comment">//#pragma clang diagnostic push // 开始</span></span><br><span class="line"><span class="preprocessor">#pragma clang diagnostic ignored <span class="title">"-Warc-performSelector-leaks"</span></span></span><br><span class="line"><span class="comment">//#pragma clang diagnostic pop // 结束</span></span><br></pre></td></tr></table></figure>
<h2 id="异常处理">异常处理</h2><ul>
<li>如果方法名错误，<strong>抛出异常</strong> <code>@throw</code></li>
<li><strong>捕获异常</strong> <code>@try @catch @finally</code></li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/OC/">OC</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2013/03/08/网络编程/" data-title="网络编程 | Bloging" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2013/03/10/多线程编程/" title="多线程编程">
  <strong>上一篇：</strong><br/>
  <span>
  多线程编程</span>
</a>
</div>


<div class="next">
<a href="/2013/03/06/数据库应用/"  title="数据库应用">
 <strong>下一篇：</strong><br/> 
 <span>数据库应用
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2013/03/08/网络编程/" data-title="网络编程" data-url="http://yoursite.com/2013/03/08/网络编程/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#网络"><span class="toc-number">1.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-number">1.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP通信"><span class="toc-number">1.2.</span> <span class="toc-text">HTTP通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS中常用的HTTP请求方式"><span class="toc-number">1.3.</span> <span class="toc-text">iOS中常用的HTTP请求方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP_实践_-_NSURLConnection(了解即可)"><span class="toc-number">1.4.</span> <span class="toc-text">HTTP 实践 - NSURLConnection(了解即可)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简单登陆界面"><span class="toc-number">1.5.</span> <span class="toc-text">简单登陆界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析JSON"><span class="toc-number">1.6.</span> <span class="toc-text">解析JSON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOS中JSON解决方案"><span class="toc-number">1.7.</span> <span class="toc-text">IOS中JSON解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NSJSONSerialization"><span class="toc-number">1.7.1.</span> <span class="toc-text">NSJSONSerialization</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#苹果自带的movie播放器"><span class="toc-number">1.8.</span> <span class="toc-text">苹果自带的movie播放器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字典转模型框架"><span class="toc-number">1.9.</span> <span class="toc-text">字典转模型框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设计框架需要考虑的问题"><span class="toc-number">1.10.</span> <span class="toc-text">设计框架需要考虑的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析XML"><span class="toc-number">1.11.</span> <span class="toc-text">解析XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSXMLParser"><span class="toc-number">1.12.</span> <span class="toc-text">XSXMLParser</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#格式化服务器返回的JSON数据"><span class="toc-number">1.12.1.</span> <span class="toc-text">格式化服务器返回的JSON数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDataXML"><span class="toc-number">1.13.</span> <span class="toc-text">GDataXML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#多值参数"><span class="toc-number">1.13.1.</span> <span class="toc-text">多值参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解决输出到控制台显示中文乱码的问题"><span class="toc-number">1.14.</span> <span class="toc-text">解决输出到控制台显示中文乱码的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#文件下载"><span class="toc-number">2.</span> <span class="toc-text">文件下载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#小文件下载"><span class="toc-number">2.1.</span> <span class="toc-text">小文件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大文件下载"><span class="toc-number">2.2.</span> <span class="toc-text">大文件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解压缩"><span class="toc-number">2.3.</span> <span class="toc-text">解压缩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件上传"><span class="toc-number">2.4.</span> <span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取MIMEType"><span class="toc-number">2.5.</span> <span class="toc-text">获取MIMEType</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSOutputStream"><span class="toc-number">2.6.</span> <span class="toc-text">NSOutputStream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSURLConnection和NSRunLoop"><span class="toc-number">2.7.</span> <span class="toc-text">NSURLConnection和NSRunLoop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSURLSession"><span class="toc-number">2.8.</span> <span class="toc-text">NSURLSession</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET"><span class="toc-number">2.8.1.</span> <span class="toc-text">GET</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST"><span class="toc-number">2.8.2.</span> <span class="toc-text">POST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载"><span class="toc-number">2.8.3.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代理方式"><span class="toc-number">2.8.4.</span> <span class="toc-text">代理方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#断点下载"><span class="toc-number">2.9.</span> <span class="toc-text">断点下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSURLSession_上传文件"><span class="toc-number">2.10.</span> <span class="toc-text">NSURLSession 上传文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AFNetworking"><span class="toc-number">2.11.</span> <span class="toc-text">AFNetworking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手机联网状态"><span class="toc-number">2.12.</span> <span class="toc-text">手机联网状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MD5加密"><span class="toc-number">2.13.</span> <span class="toc-text">MD5加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPS"><span class="toc-number">2.14.</span> <span class="toc-text">HTTPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIWebView"><span class="toc-number">2.15.</span> <span class="toc-text">UIWebView</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS介绍"><span class="toc-number">2.16.</span> <span class="toc-text">JS介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML5"><span class="toc-number">2.16.1.</span> <span class="toc-text">HTML5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OC执行JS"><span class="toc-number">2.17.</span> <span class="toc-text">OC执行JS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS执行OC"><span class="toc-number">2.18.</span> <span class="toc-text">JS执行OC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#程序崩溃处理"><span class="toc-number">2.19.</span> <span class="toc-text">程序崩溃处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#去除Xcode编译警告"><span class="toc-number">2.20.</span> <span class="toc-text">去除Xcode编译警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异常处理"><span class="toc-number">2.21.</span> <span class="toc-text">异常处理</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/OC/" title="OC">OC<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/swift/" title="swift">swift<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/oc/" title="oc">oc<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> This is my blog,believe it or not. <br/>
			To be or not to be, this is the question.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1728379850" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/slq0378" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/5396469" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		
		<a href="https://www.facebook.com/song.liquan" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		<a href="http://www.zhihu.com/people/song88" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:slq0378@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Mr Song">Mr Song</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"Song"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-68091434-1', 'auto');  
ga('send', 'pageview');
</script>



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
