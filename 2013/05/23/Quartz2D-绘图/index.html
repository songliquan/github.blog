
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Quartz2D-绘图 | Bloging</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Mr Song">
    
    <meta name="description" content="Quartz2D-绘图简介
Quartz 2D是一个二维绘图引擎，同时支持iOS和Mac系统
Quartz 2D能完成的工作
绘制图形 : 线条\三角形\矩形\圆\弧等
绘制文字
绘制\生成图片(图像)
自定义UI控件


使用Quartz 2D绘制图形需要绘制在UIView上，而且要自定义的vie">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Bloging" title="Bloging"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Bloging">Bloging</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">存档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/05/23/Quartz2D-绘图/" title="Quartz2D-绘图" itemprop="url">Quartz2D-绘图</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="Mr Song">Mr Song</a>
    </p>
  <p class="article-time">
    <time datetime="2013-05-23T06:48:09.000Z" itemprop="datePublished">2013-05-23</time>
    更新日期:<time datetime="2015-09-27T04:41:45.000Z" itemprop="dateModified">2015-09-27</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Quartz2D-绘图"><span class="toc-number">1.</span> <span class="toc-text">Quartz2D-绘图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#几种简单的绘图方式"><span class="toc-number">1.2.</span> <span class="toc-text">几种简单的绘图方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文本显示"><span class="toc-number">1.3.</span> <span class="toc-text">文本显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#富文本显示"><span class="toc-number">1.4.</span> <span class="toc-text">富文本显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#绘制图片到视图"><span class="toc-number">1.5.</span> <span class="toc-text">绘制图片到视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#绘图刷新-定时器"><span class="toc-number">1.6.</span> <span class="toc-text">绘图刷新-定时器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#矩阵操作"><span class="toc-number">1.7.</span> <span class="toc-text">矩阵操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#水印处理"><span class="toc-number">1.8.</span> <span class="toc-text">水印处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图形裁切"><span class="toc-number">1.9.</span> <span class="toc-text">图形裁切</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#屏幕截图"><span class="toc-number">1.10.</span> <span class="toc-text">屏幕截图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手势解锁"><span class="toc-number">1.11.</span> <span class="toc-text">手势解锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画板"><span class="toc-number">1.12.</span> <span class="toc-text">画板</span></a></li></ol></li></ol>
		</div>
		
		<h1 id="Quartz2D-绘图">Quartz2D-绘图</h1><h2 id="简介">简介</h2><ul>
<li>Quartz 2D是一个二维绘图引擎，同时支持iOS和Mac系统</li>
<li>Quartz 2D能完成的工作<ul>
<li>绘制图形 : 线条\三角形\矩形\圆\弧等</li>
<li>绘制文字</li>
<li>绘制\生成图片(图像)</li>
<li>自定义UI控件</li>
</ul>
</li>
<li><p>使用Quartz 2D绘制图形需要绘制在UIView上，而且要自定义的view。</p>
</li>
<li><p>自定义view的步骤</p>
<ul>
<li>1、新建一个类，继承自UIView</li>
<li>2、实现- (void)drawRect:(CGRect)rect方法，然后在这个方法中</li>
<li>3、取得跟当前view相关联的图形上下文</li>
<li>4、绘制相应的图形内容</li>
<li>5、利用图形上下文将绘制的所有内容渲染显示到view上面</li>
</ul>
</li>
</ul>
<h2 id="几种简单的绘图方式">几种简单的绘图方式</h2><ul>
<li>绘图方式1</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#pragma mark - 最原始的绘图方式1</span></span><br><span class="line">- (<span class="keyword">void</span>)draw2 &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="comment">//获得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> con = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 创建路径</span></span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">    <span class="comment">// 绘制一条线</span></span><br><span class="line">    <span class="comment">//    CGPathMoveToPoint(path, NULL, 50, 50);</span></span><br><span class="line">    <span class="comment">//    CGPathAddLineToPoint(path, NULL, 200, 200);</span></span><br><span class="line">    <span class="comment">// 绘制矩形</span></span><br><span class="line">    <span class="comment">//    CGPathAddRect(path, NULL, CGRectMake(60, 60, 100, 100));</span></span><br><span class="line">    <span class="comment">//    CGPathAddEllipseInRect(path, NULL, CGRectMake(60, 60, 100, 100));</span></span><br><span class="line">    <span class="comment">// 圆角矩形</span></span><br><span class="line">    <span class="comment">//    CGPathAddRoundedRect(path, NULL, CGRectMake(60, 60, 100, 100), 5, 5);</span></span><br><span class="line">    <span class="comment">// 弧线</span></span><br><span class="line">    <span class="built_in">CGPathAddArc</span>(path, <span class="literal">NULL</span>, <span class="number">100</span>, <span class="number">100</span>,<span class="number">30</span>, <span class="number">0</span>, M_PI, <span class="literal">YES</span>);</span><br><span class="line">    <span class="comment">// 添加路径到上下文中</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(con, path);</span><br><span class="line">    <span class="comment">// 显示到view中</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(con);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>绘图方式2</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#pragma mark - 绘图方式2</span></span><br><span class="line">- (<span class="keyword">void</span>)draw1 &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="comment">//获得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> con = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 绘制路径</span></span><br><span class="line">    <span class="comment">// 绘制直线</span></span><br><span class="line">    <span class="comment">//    CGContextMoveToPoint(con, 0, 0);</span></span><br><span class="line">    <span class="comment">//    CGContextAddLineToPoint(con, 100, 100);</span></span><br><span class="line">    <span class="comment">//    CGContextAddLineToPoint(con, 50, 100);</span></span><br><span class="line">    <span class="comment">//CGContextMoveToPoint(con, 50, 50);</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 绘制圆</span></span><br><span class="line">    <span class="comment">//    CGContextAddEllipseInRect(con, CGRectMake(60, 60, 100, 100));</span></span><br><span class="line">    <span class="comment">// 绘制椭圆</span></span><br><span class="line">    <span class="comment">//    CGContextAddEllipseInRect(con, CGRectMake(60, 60, 150, 100));</span></span><br><span class="line">    <span class="comment">// 绘制矩形</span></span><br><span class="line">    <span class="comment">//    CGContextAddRect(con, CGRectMake(60, 60, 150, 100));</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(con, <span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, M_PI, M_PI_2, <span class="literal">YES</span>);</span><br><span class="line">    <span class="comment">// 显示到view中</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(con);</span><br></pre></td></tr></table></figure>
<ul>
<li>绘图方式3</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#pragma mark - 绘图方式3-贝瑟尔路径绘图</span></span><br><span class="line"><span class="comment">// 贝瑟尔路径绘图</span></span><br><span class="line">- (<span class="keyword">void</span>)draw3 &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="comment">// UIKit已经封装了一些绘图的功能</span></span><br><span class="line">    <span class="comment">// 贝瑟尔路径</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPathbezierPath</span>];</span><br><span class="line">    <span class="comment">// 绘制路径</span></span><br><span class="line">    <span class="comment">//    [path moveToPoint:CGPointMake(100, 100)];</span></span><br><span class="line">    <span class="comment">//    [path addLineToPoint:CGPointMake(200, 200)];</span></span><br><span class="line">    <span class="comment">// 圆弧</span></span><br><span class="line">    [path addArcWithCenter:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>) radius:<span class="number">50</span>startAngle:<span class="number">0</span>endAngle:M_PIclockwise:<span class="literal">YES</span>];<span class="comment">// 顺时针绘制一个弧线</span></span><br><span class="line">    [path addLineToPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    [[<span class="built_in">UIColorredColor</span>] setStroke]; <span class="comment">// 设置线条颜色</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    path<span class="variable">.lineJoinStyle</span> = k<span class="built_in">CGLineJoinRound</span>; <span class="comment">//</span></span><br><span class="line">    path<span class="variable">.lineWidth</span> = <span class="number">2</span>; <span class="comment">// 宽度</span></span><br><span class="line">    path<span class="variable">.lineCapStyle</span> = k<span class="built_in">CGLineCapRound</span>; <span class="comment">// 样式</span></span><br><span class="line">    [path fill];</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    [path stroke];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>绘图状态的设置</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#pragma mark - 设置线条状态在渲染之前</span></span><br><span class="line">- (<span class="keyword">void</span>)draw4 &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="comment">// 获得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ct = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 绘制路径</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(ct, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ct, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ct, <span class="number">100</span>, <span class="number">300</span>);</span><br><span class="line">    <span class="comment">// 设置绘图状态，一定要在渲染之前设置，并且一经设置，状态会一直持续下去，除非再次改变。</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ct, <span class="number">5</span>);</span><br><span class="line">    [[<span class="built_in">UIColorredColor</span>] setStroke];</span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(ct, k<span class="built_in">CGLineJoinRound</span>);</span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(ct, k<span class="built_in">CGLineCapRound</span>);</span><br><span class="line">    <span class="comment">// 渲染</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ct);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>绘制包含多个状态的图形</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="comment">// 绘制多个状态不同的线</span></span><br><span class="line">    <span class="comment">// 获得图形上下文</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">    <span class="comment">// 绘制路径</span></span><br><span class="line">    [path moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    [path addLineToPoint:<span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    <span class="comment">// 设置绘图状态，一定要在渲染之前设置，并且一经设置，状态会一直持续下去，除非再次改变。</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] setStroke];</span><br><span class="line">    <span class="comment">// 渲染</span></span><br><span class="line">    [path stroke];</span><br><span class="line">    <span class="comment">// 获得图形上下文</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path1 = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">    <span class="comment">// 绘制路径</span></span><br><span class="line">    [path1 moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">200</span> , <span class="number">200</span>)];</span><br><span class="line">    [path1 addLineToPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">150</span>)];</span><br><span class="line">    <span class="comment">// 设置绘图状态，一定要在渲染之前设置，并且一经设置，状态会一直持续下去，除非再次改变。</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blueColor] setStroke];</span><br><span class="line">    <span class="comment">// 渲染</span></span><br><span class="line">    [path1 stroke];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##绘制饼状图</p>
<ul>
<li><p>首先花圆弧，然后连接圆心，最后填充位一个扇形</p>
<p><img src="../images/屏幕快照 2015-06-21 12.44.58.png" alt=""></p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 饼状图2</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect&#123;</span><br><span class="line">    <span class="built_in">NSArray</span> *arr = [<span class="keyword">self</span> randomArray]; <span class="comment">// 随机地返回一个数组，数组元素和为100</span></span><br><span class="line">    <span class="comment">// 获取半径和圆心</span></span><br><span class="line">    <span class="built_in">CGFloat</span> radius = <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>/<span class="number">2</span> - <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">CGPoint</span> center = <span class="built_in">CGPointMake</span>(radius, radius);</span><br><span class="line">    <span class="comment">// 绘制角度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startAngle = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> endAngle = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 绘制图形</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; arr<span class="variable">.count</span>; i ++) &#123;</span><br><span class="line">        <span class="comment">// 计算角度</span></span><br><span class="line">        endAngle = startAngle + [arr[i] floatValue] / <span class="number">100.0</span> * M_PI * <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// 绘制图形</span></span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithArcCenter:center radius:radius startAngle:startAngle endAngle:endAngle clockwise:<span class="literal">YES</span>];</span><br><span class="line">        [path addLineToPoint:center];</span><br><span class="line">        startAngle = endAngle;</span><br><span class="line">        <span class="comment">// 设置颜色</span></span><br><span class="line">        [[<span class="keyword">self</span> randomColor] set];</span><br><span class="line">        <span class="comment">// 填充，并且把终点和起始点连接起来</span></span><br><span class="line">        [path fill];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>随机返回数组，且元素和为100</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回随机数组，且数组元素和为100</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)randomArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArrayarray</span>];</span><br><span class="line">    <span class="keyword">int</span> total = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; arc4random_uniform(<span class="number">10</span>) + <span class="number">1</span>;i ++) &#123;</span><br><span class="line">        <span class="comment">// 100 1~100</span></span><br><span class="line">        temp = arc4random_uniform(total) + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 随机出来的临时值等于总值，直接退出循环，因为已经把总数分配完毕，没必要在分配。</span></span><br><span class="line">        [arr addObject:@(temp)];</span><br><span class="line">         <span class="comment">// 解决方式：当随机出来的数等于总数直接退出循环。</span></span><br><span class="line">        <span class="keyword">if</span> (temp == total) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        total -= temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果总数大于0就添加到数组中</span></span><br><span class="line">    <span class="keyword">if</span> (total ) &#123;</span><br><span class="line">        [arr addObject:@(total)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>返回随机颜色</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回随机的颜色</span></span><br><span class="line">- (<span class="built_in">UIColor</span> *)randomColor</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// iOS：RGB返回是0~1</span></span><br><span class="line">    <span class="built_in">CGFloat</span> r = arc4random_uniform(<span class="number">256</span>) / <span class="number">255.0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> g = arc4random_uniform(<span class="number">256</span>) / <span class="number">255.0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> b = arc4random_uniform(<span class="number">256</span>) / <span class="number">255.0</span>;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">UIColorcolorWithRed</span>:r green:g blue:b alpha:<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##绘制柱状图</p>
<ul>
<li><p>计算方柱个数，平分宽度，高度按占视图比例计算。</p>
<p> <img src="../images/屏幕快照 2015-06-21 12.54.31.png" alt=""></p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 柱状图</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// 随机地返回一个数组，数组元素和为100</span></span><br><span class="line">    <span class="built_in">NSArray</span> *arr = [<span class="keyword">self</span> randomArray];</span><br><span class="line">    <span class="comment">// 起始点和高度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> w = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> h = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">NSInteger</span> count = arr<span class="variable">.count</span>;</span><br><span class="line">    <span class="comment">// 宽度</span></span><br><span class="line">    w = rect<span class="variable">.size</span><span class="variable">.width</span> / (<span class="number">2</span>*count - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; arr<span class="variable">.count</span>; i ++) &#123;</span><br><span class="line">        <span class="comment">// x坐标</span></span><br><span class="line">        x = <span class="number">2</span>*i * w;</span><br><span class="line">        <span class="comment">// 高度</span></span><br><span class="line">        h = [arr[i] floatValue] / <span class="number">100.0</span> * rect<span class="variable">.size</span><span class="variable">.height</span>;</span><br><span class="line">        <span class="comment">// y坐标</span></span><br><span class="line">        y = rect<span class="variable">.size</span><span class="variable">.height</span> - h;</span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithRect:<span class="built_in">CGRectMake</span>(x, y, w, h)];</span><br><span class="line">        [[<span class="keyword">self</span> randomColor] set];</span><br><span class="line">        [path fill];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文本显示">文本显示</h2><p><img src="../images/屏幕快照 2015-06-21 12.58.54.png" alt=""></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文本显示</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"哈尽快回家的客户发动机可舒服哈的尽快发货阿红的健康法哈德减肥哈第三方阿姐回复就爱的客户房间卡地方哈就等哈接电话发掘"</span>;</span><br><span class="line">    <span class="comment">// 这个方法不会自动换行</span></span><br><span class="line"><span class="comment">//    [str drawAtPoint:CGPointZero withAttributes:nil];</span></span><br><span class="line">    <span class="comment">// 自动换行</span></span><br><span class="line">    [str drawInRect:rect withAttributes:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="富文本显示">富文本显示</h2><p><img src="../images/屏幕快照 2015-06-21 12.59.51.png" alt=""></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 富文本：带有状态的文本</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"哈尽快回家的客户发动机可舒服哈的尽快发货阿红的健康法哈德减肥哈第三方阿姐回复就爱的客户房间卡地方哈就等哈接电话发掘"</span>;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionarydictionary</span>];</span><br><span class="line">    <span class="comment">// 属性的设置可以在UIkit框架的头文件里找到解释</span></span><br><span class="line">    <span class="comment">// 字体颜色</span></span><br><span class="line">    dict[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColorredColor</span>];</span><br><span class="line">    <span class="comment">// 字体大小</span></span><br><span class="line">    dict[<span class="built_in">NSFontAttributeName</span>] = [<span class="built_in">UIFontsystemFontOfSize</span>:<span class="number">30</span>];</span><br><span class="line">    <span class="comment">// 字体粗细</span></span><br><span class="line">    dict[<span class="built_in">NSStrokeWidthAttributeName</span>] = @<span class="number">5</span>;</span><br><span class="line">    <span class="comment">// 颜色</span></span><br><span class="line">    dict[<span class="built_in">NSStrokeColorAttributeName</span>] = [<span class="built_in">UIColorgreenColor</span>];</span><br><span class="line">    <span class="comment">// 阴影</span></span><br><span class="line">    <span class="built_in">NSShadow</span> *sha = [[<span class="built_in">NSShadow</span> alloc] init];</span><br><span class="line">    sha<span class="variable">.shadowOffset</span> = <span class="built_in">CGSizeMake</span>(<span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line">    sha<span class="variable">.shadowBlurRadius</span> = <span class="number">10</span>;</span><br><span class="line">    sha<span class="variable">.shadowColor</span> = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    dict[<span class="built_in">NSShadowAttributeName</span>] = sha;</span><br><span class="line">    <span class="comment">// 绘制到视图</span></span><br><span class="line">    [str drawInRect:rect withAttributes:dict];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="绘制图片到视图">绘制图片到视图</h2><ul>
<li>drawAtPoint</li>
</ul>
<p><img src="../images/屏幕快照 2015-06-21 13.03.43.png" alt=""></p>
<ul>
<li>drawInRect</li>
</ul>
<p><img src="../images/屏幕快照 2015-06-21 13.03.26.png" alt=""></p>
<ul>
<li>drawAsPatternInrect</li>
</ul>
<p><img src="../images/屏幕快照 2015-06-21 13.03.53.png" alt=""></p>
<ul>
<li><p>裁剪</p>
<p><img src="../images/屏幕快照 2015-06-21 13.04.30.png" alt=""></p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绘制图形</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 超出裁剪区域的内容全部裁剪掉</span></span><br><span class="line">    <span class="comment">// 注意：裁剪必须放在绘制之前</span></span><br><span class="line">   <span class="comment">// UIRectClip(CGRectMake(0, 0, 100, 100));</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"010"</span>];</span><br><span class="line">    <span class="comment">// 默认按照图片比例显示</span></span><br><span class="line"><span class="comment">//    [image drawAtPoint:CGPointZero];</span></span><br><span class="line">    <span class="comment">// 将整个图片显示到rect中，拉伸或者缩小</span></span><br><span class="line">    [image drawInRect:rect];</span><br><span class="line">    <span class="comment">// 默认填充显示</span></span><br><span class="line"><span class="comment">//    [image drawAsPatternInRect:rect];</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>图形上下文状态</p>
</li>
<li><p>保存某个状态到栈顶，用于之后恢复。</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图形上下文3 UIBezierPath:使用[path stroke];时上下文状态有UIBezierPath自身决定</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//保存上下文状态,如果使用这种方法保存上下文状态的话，需要设置以CGContext开头的那些函数设置状态，</span></span><br><span class="line">    <span class="comment">// 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 绘制第一条线</span></span><br><span class="line">    <span class="comment">// 贝塞尔路线</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path  = [<span class="built_in">UIBezierPathbezierPath</span>];</span><br><span class="line">    <span class="comment">// 绘制路径</span></span><br><span class="line">    [path moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">55</span>, <span class="number">55</span>)];</span><br><span class="line">    [path addLineToPoint:<span class="built_in">CGPointMake</span>(<span class="number">99</span>, <span class="number">90</span>)];</span><br><span class="line">    <span class="comment">// 添加路径到上下文</span></span><br><span class="line">    <span class="comment">//将c路径转换成oc对象：CGPath</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path<span class="variable">.CGPath</span>);</span><br><span class="line">    <span class="comment">// 保存上下文状态</span></span><br><span class="line">    <span class="built_in">CGContextSaveGState</span>(ctx);</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">5</span>);</span><br><span class="line">    [[<span class="built_in">UIColorredColor</span>] setStroke];</span><br><span class="line">    <span class="comment">// 渲染上下文</span></span><br><span class="line"><span class="comment">//    [path stroke];</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">    <span class="comment">// 绘制第二条线</span></span><br><span class="line">    path  = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">    <span class="comment">// 绘制路径</span></span><br><span class="line">    [path moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">10</span>)];</span><br><span class="line">    [path addLineToPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">80</span>)];</span><br><span class="line">    <span class="comment">// 恢复上下文状态</span></span><br><span class="line">    <span class="built_in">CGContextRestoreGState</span>(ctx);</span><br><span class="line">    <span class="comment">// 添加路径到上下文</span></span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path<span class="variable">.CGPath</span>);</span><br><span class="line"><span class="comment">//    [[UIColor blueColor] setStroke];</span></span><br><span class="line">    <span class="comment">// 渲染</span></span><br><span class="line"><span class="comment">//    [path stroke];</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="绘图刷新-定时器">绘图刷新-定时器</h2><ul>
<li>如果在绘图的时候需要用到定时器，通常CADisplayLink<br>NSTimer很少用于绘图，因为调度优先级比较低，并不会准时调用</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果在绘图的时候需要用到定时器，通常CADisplayLink</span></span><br><span class="line"><span class="comment">// NSTimer很少用于绘图，因为调度优先级比较低，并不会准时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)awakeFromNib</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 添加计时器，改变_smailY的值</span></span><br><span class="line"><span class="comment">//    比起NSTimer，CADisplayLink可以确保系统渲染每一帧的时候我们的方法都被调用，从而保证了动画的流畅性。</span></span><br><span class="line">    <span class="comment">// CADisplayLink:每次屏幕刷新的时候就会调用，屏幕一般一秒刷新60次</span></span><br><span class="line">    <span class="built_in">CADisplayLink</span> *link = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(timeChange)];</span><br><span class="line">    <span class="comment">// 添加至运行主循环</span></span><br><span class="line">    [link addToRunLoop:[<span class="built_in">NSRunLoop</span> mainRunLoop] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)timeChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 注意：这个方法并不会马上调用drawRect,其实这个方法只是给当前控件添加刷新的标记，等下一次屏幕刷新的时候才会调用drawRect</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="矩阵操作">矩阵操作</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上下文矩阵操作</span></span><br><span class="line"><span class="comment">// 注意:矩阵操作必须要在添加路径之前</span></span><br><span class="line">-(<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取图形山下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx1 = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">//    CGContextSaveGState(ctx1);</span></span><br><span class="line">    <span class="comment">// 绘制路径1</span></span><br><span class="line"><span class="comment">//    CGContextMoveToPoint(ctx1, 50, 50);</span></span><br><span class="line">    <span class="built_in">CGContextTranslateCTM</span>(ctx1, <span class="number">100</span>, <span class="number">0</span>); <span class="comment">// 添加路径之前进行矩阵操作</span></span><br><span class="line">    <span class="built_in">CGContextScaleCTM</span>(ctx1, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">CGContextRotateCTM</span>(ctx1, M_PI_2);</span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx1, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">90</span>));</span><br><span class="line">    [[<span class="built_in">UIColorredColor</span>] setStroke];</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx1, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(ctx1, k<span class="built_in">CGLineJoinRound</span>);</span><br><span class="line">    <span class="comment">// 渲染路径</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="水印处理">水印处理</h2><ul>
<li>给图片添加文字、图片水印</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 水印处理</span></span><br><span class="line">- (<span class="keyword">void</span>)shuiyin</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 水印处理</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image  = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"4"</span>];</span><br><span class="line">    <span class="built_in">UIImage</span> *image2  = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"010"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CGFloat</span> imageH = image<span class="variable">.size</span><span class="variable">.height</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> imageW = image<span class="variable">.size</span><span class="variable">.width</span>;</span><br><span class="line">    <span class="comment">// 获取位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(image<span class="variable">.size</span>, <span class="literal">NO</span>, <span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绘制图形或者文字</span></span><br><span class="line">    [image drawAtPoint:<span class="built_in">CGPointZero</span>];</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"@zhang@163.com"</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> strlenth = str<span class="variable">.length</span> * <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// 文字水印</span></span><br><span class="line">    [str drawAtPoint:<span class="built_in">CGPointMake</span>(imageW - strlenth, imageH - <span class="number">44</span>) withAttributes:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 图片水印</span></span><br><span class="line">    [image2 drawAtPoint:<span class="built_in">CGPointMake</span>(imageW - strlenth - <span class="number">66</span>, imageH - <span class="number">66</span>)];</span><br><span class="line">    <span class="comment">// 关闭位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsEndPDFContext</span>();</span><br><span class="line">    <span class="comment">// 获取位图</span></span><br><span class="line">    _imageView<span class="variable">.image</span> = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="comment">// 保存图片，需要转换成二进制数据</span></span><br><span class="line">    <span class="built_in">NSData</span> *data = <span class="built_in">UIImageJPEGRepresentation</span>(_imageView<span class="variable">.image</span>, <span class="number">1</span>); <span class="comment">// 参数2表示图片质量</span></span><br><span class="line">    <span class="built_in">NSData</span> *data1 = <span class="built_in">UIImagePNGRepresentation</span>(_imageView<span class="variable">.image</span>); <span class="comment">// png默认最高质量</span></span><br><span class="line">    <span class="comment">// 写入文件</span></span><br><span class="line">    [data1 writeToFile:<span class="string">@"/Users/song/Desktop/me.png"</span>atomically:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../images/屏幕快照 2015-06-21 17.44.27.png" alt=""></p>
<h2 id="图形裁切">图形裁切</h2><ul>
<li>首先设置一个裁切区域，然后在裁切区域显示图片。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图形裁切</span></span><br><span class="line">- (<span class="keyword">void</span>)clipImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"4"</span>];</span><br><span class="line">    <span class="comment">// 获取位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(image<span class="variable">.size</span>,<span class="literal">NO</span>,<span class="number">0.0</span>);</span><br><span class="line">    <span class="comment">// 设置圆形裁剪区域，正切与图片</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, image<span class="variable">.size</span><span class="variable">.width</span>, image<span class="variable">.size</span><span class="variable">.height</span>)];</span><br><span class="line">    <span class="comment">// 添加裁切区域</span></span><br><span class="line">    [path addClip];</span><br><span class="line">    <span class="comment">// 绘制图片</span></span><br><span class="line">    [ima drawAtPoint:<span class="built_in">CGPointZero</span>];</span><br><span class="line">    <span class="comment">// 从上下文获取图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="comment">// 关闭位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    <span class="comment">// 显示位图</span></span><br><span class="line">    _imageView<span class="variable">.image</span> = image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../images/屏幕快照 2015-06-21 18.22.15.png" alt=""></p>
<ul>
<li>带边框的圆形裁切<ul>
<li>首先绘制一个红色的圆，然后在圆中心绘制图片，保留一定的边框。</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 带边框的原型裁切</span></span><br><span class="line">- (<span class="keyword">void</span>)cicleAroundImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1、绘制一个大圆，设置背景色</span></span><br><span class="line">    <span class="comment">// 获取图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *ima = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"4"</span>];</span><br><span class="line">    <span class="comment">// 图片宽高</span></span><br><span class="line">    <span class="built_in">CGFloat</span> imageW = ima<span class="variable">.size</span><span class="variable">.width</span>;</span><br><span class="line">    <span class="comment">// 边界宽度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> boarder = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// 圆环宽高</span></span><br><span class="line">    <span class="built_in">CGFloat</span> cicleW = imageW + <span class="number">2</span> * boarder;</span><br><span class="line">    <span class="comment">// 获取位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(<span class="built_in">CGSizeMake</span>(cicleW, cicleW),<span class="literal">NO</span>,<span class="number">0.0</span>);</span><br><span class="line">    <span class="comment">// 绘制圆形</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, cicleW, cicleW)];</span><br><span class="line">    <span class="comment">// 填充红色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    [path fill];</span><br><span class="line">    <span class="comment">// 2、绘制图片，要比大圆小一点</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *clipArea = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(boarder , boarder, imageW, imageW)];</span><br><span class="line">    <span class="comment">// 裁切</span></span><br><span class="line">    [clipArea addClip];</span><br><span class="line">    <span class="comment">// 绘制图片</span></span><br><span class="line">    [ima drawAtPoint:<span class="built_in">CGPointMake</span>(boarder, boarder)];</span><br><span class="line">    <span class="comment">// 从上下文获取图片</span></span><br><span class="line">     <span class="built_in">UIImage</span> *image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">     <span class="comment">// 关闭位图上下文</span></span><br><span class="line">     <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">     <span class="comment">// 显示位图</span></span><br><span class="line">     _imageView<span class="variable">.image</span> = image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../images/屏幕快照 2015-06-21 20.03.200.png" alt=""></p>
<ul>
<li>带有边框的裁切可以使用一个分类</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"UIImage+image.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIImage</span> (<span class="title">image</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ (instancetype) imageWithImage:(<span class="built_in">UIImage</span> *)image withBoard:(<span class="built_in">CGFloat</span> )board withColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1、绘制一个大圆，设置背景色</span></span><br><span class="line">    <span class="comment">// 获取图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *ima = image;</span><br><span class="line">    <span class="comment">// 图片宽高</span></span><br><span class="line">    <span class="built_in">CGFloat</span> imageW = ima<span class="variable">.size</span><span class="variable">.width</span>;</span><br><span class="line">    <span class="comment">// 边界宽度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> boarder = board;</span><br><span class="line">    <span class="comment">// 圆环宽高</span></span><br><span class="line">    <span class="built_in">CGFloat</span> cicleW = imageW + <span class="number">2</span> * boarder;</span><br><span class="line">    <span class="comment">// 获取位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(<span class="built_in">CGSizeMake</span>(cicleW, cicleW),<span class="literal">NO</span>,<span class="number">0.0</span>);</span><br><span class="line">    <span class="comment">// 绘制圆形</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, cicleW, cicleW)];</span><br><span class="line">    <span class="comment">// 填充红色</span></span><br><span class="line">    [color set];</span><br><span class="line">    [path fill];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、绘制图片，要比大圆小一点</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *clipArea = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(boarder , boarder, imageW, imageW)];</span><br><span class="line">    <span class="comment">// 裁切</span></span><br><span class="line">    [clipArea addClip];</span><br><span class="line">    <span class="comment">// 绘制图片</span></span><br><span class="line">    [ima drawAtPoint:<span class="built_in">CGPointMake</span>(boarder, boarder)];</span><br><span class="line">    <span class="comment">// 从上下文获取图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *clipImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="comment">// 关闭位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    <span class="comment">// 显示位图</span></span><br><span class="line">    <span class="keyword">return</span> clipImage;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用起来也方便，直接包含头文件即可使用</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"ViewController.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"UIImage+image.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@interfaceViewController ()</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span><span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 使用分类</span></span><br><span class="line">    <span class="built_in">UIImage</span> *ima = [<span class="built_in">UIImage</span> imageWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"4"</span>] withBoard:<span class="number">3</span> withColor:[<span class="built_in">UIColor</span> blueColor]];</span><br><span class="line">    _imageView<span class="variable">.image</span> = ima;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="屏幕截图">屏幕截图</h2><ul>
<li>主要是从控制器上获取图层。一定要使用 renderInContext: 进行渲染，不可使用draw…</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 屏幕截图</span></span><br><span class="line">- (<span class="keyword">void</span>)snipImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//获取位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(<span class="keyword">self</span><span class="variable">.view</span><span class="variable">.bounds</span><span class="variable">.size</span>, <span class="literal">NO</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 获取当前上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 渲染控制器图层到图形上下文，把控件上的图层渲染到上下文,layer只能渲染</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.view</span><span class="variable">.layer</span> renderInContext:ctx];</span><br><span class="line">    <span class="comment">// 获取图形上下文</span></span><br><span class="line">    <span class="built_in">UIImage</span> *snipImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="comment">// 关闭位图上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    <span class="built_in">NSData</span> *data = <span class="built_in">UIImagePNGRepresentation</span>(snipImage);</span><br><span class="line">    [data writeToFile:<span class="string">@"/Users/song/Desktop/snip.png"</span>atomically:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="手势解锁">手势解锁</h2><ul>
<li><p>效果<br><img src="../images/手势解锁.gif" alt=""></p>
</li>
<li><p>4.1、界面</p>
<ul>
<li>在storyboard里添加一个view用来显示九宫格<br><img src="../images/屏幕快照 2015-06-21 22.37.35.png" alt=""></li>
</ul>
</li>
<li><p>4.2、新建一个类继承自UIView</p>
</li>
<li>添加按钮</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加按钮</span></span><br><span class="line">- (<span class="keyword">void</span>)awakeFromNib</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> awakeFromNib];</span><br><span class="line">    <span class="comment">// 创建按钮</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>;  i &lt; <span class="number">9</span>; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButtonbuttonWithType</span>:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImageimageNamed</span>:<span class="string">@"gesture_node_normal"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImageimageNamed</span>:<span class="string">@"gesture_node_highlighted"</span>] forState:<span class="built_in">UIControlStateSelected</span>];</span><br><span class="line">        btn<span class="variable">.userInteractionEnabled</span> = <span class="literal">NO</span>;</span><br><span class="line">        btn<span class="variable">.tag</span> = i;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置按钮frame</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 九宫格按钮计算</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    <span class="comment">// 按钮个数</span></span><br><span class="line">    <span class="built_in">NSInteger</span> count = <span class="keyword">self</span><span class="variable">.subviews</span><span class="variable">.count</span>;</span><br><span class="line">    <span class="comment">// 按钮宽度和高度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> w = <span class="number">74</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> h = <span class="number">74</span>;</span><br><span class="line">    <span class="comment">// 行</span></span><br><span class="line">    <span class="built_in">NSInteger</span> cols = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// 列</span></span><br><span class="line">    <span class="built_in">NSInteger</span> rows = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// 间距</span></span><br><span class="line">    <span class="built_in">CGFloat</span> margin = (<span class="keyword">self</span><span class="variable">.bounds</span><span class="variable">.size</span><span class="variable">.width</span> - cols * w)/(cols + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 设置frame</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>;  i &lt; count; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = (<span class="built_in">UIButton</span> *)<span class="keyword">self</span><span class="variable">.subviews</span>[i];</span><br><span class="line">        <span class="comment">// 当前行</span></span><br><span class="line">        <span class="built_in">NSInteger</span> row = i / rows;</span><br><span class="line">        <span class="comment">// 当前列</span></span><br><span class="line">        <span class="built_in">NSInteger</span> col = i % cols;</span><br><span class="line">        <span class="comment">// x</span></span><br><span class="line">        x = margin + col * (margin + w);</span><br><span class="line">        <span class="comment">// y</span></span><br><span class="line">        y = row * (margin + h);</span><br><span class="line">        btn<span class="variable">.frame</span> = <span class="built_in">CGRectMake</span>(x, y, w, h);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>定义一个可变数组用来保存选中按钮</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *selectedBtn;</span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)selectedBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_selectedBtn == <span class="literal">nil</span>) &#123;</span><br><span class="line">        _selectedBtn = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  _selectedBtn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>实现滑动手势方法</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)pan:(<span class="built_in">UIPanGestureRecognizer</span> *)sender &#123;</span><br><span class="line"><span class="comment">//    NSLog(@"pan");</span></span><br><span class="line">    <span class="comment">// 获取触摸点</span></span><br><span class="line">    _curP = [sender locationInView:<span class="keyword">self</span>];</span><br><span class="line">    <span class="comment">// 遍历按钮数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *btn <span class="keyword">in</span> <span class="keyword">self</span><span class="variable">.subviews</span>) &#123;</span><br><span class="line">        <span class="comment">// 判断点是否包含在按钮中</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">CGRectContainsPoint</span>(btn<span class="variable">.frame</span>, _curP) &amp;&amp; !btn<span class="variable">.selected</span> ) &#123;</span><br><span class="line">            btn<span class="variable">.selected</span> = <span class="literal">YES</span>;</span><br><span class="line">            [<span class="keyword">self</span><span class="variable">.selectedBtn</span> addObject:btn];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重绘</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">    <span class="comment">// 恢复原状</span></span><br><span class="line">    <span class="keyword">if</span> (sender<span class="variable">.state</span> == <span class="built_in">UIGestureRecognizerStateEnded</span> ) &#123;</span><br><span class="line">        <span class="comment">// 保存密码</span></span><br><span class="line">        <span class="built_in">NSMutableString</span> *str = [<span class="built_in">NSMutableStringstring</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *btn <span class="keyword">in</span> <span class="keyword">self</span><span class="variable">.selectedBtn</span>) &#123;</span><br><span class="line">           [ str appendFormat:<span class="string">@"%ld"</span>,btn<span class="variable">.tag</span> ];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,str);</span><br><span class="line">        <span class="comment">// 删除选中状态</span></span><br><span class="line">        [<span class="keyword">self</span><span class="variable">.selectedBtn</span> makeObjectsPerformSelector:<span class="keyword">@selector</span>(setSelected:) withObject:@(<span class="literal">NO</span>)];</span><br><span class="line">        <span class="comment">// 情况选中数组</span></span><br><span class="line">        [<span class="keyword">self</span><span class="variable">.selectedBtn</span> removeAllObjects];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>然后在drawRect中进行连线</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 没有选中按钮，直接退出</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.selectedBtn</span><span class="variable">.count</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 把所有选中的按钮连线</span></span><br><span class="line">    <span class="built_in">NSInteger</span> count = <span class="keyword">self</span><span class="variable">.selectedBtn</span><span class="variable">.count</span>;</span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPathbezierPath</span>];</span><br><span class="line">    <span class="comment">// 遍历选中按钮数组，对按钮连线</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; count ; i ++)  &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = <span class="keyword">self</span><span class="variable">.selectedBtn</span>[i];</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 设置起点</span></span><br><span class="line">            [path moveToPoint:btn<span class="variable">.center</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            [path addLineToPoint:btn<span class="variable">.center</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 连接到当前点</span></span><br><span class="line">    [path addLineToPoint:_curP];</span><br><span class="line">    <span class="comment">// 设置连线样式</span></span><br><span class="line">    [[<span class="built_in">UIColorgreenColor</span>] set];</span><br><span class="line">    path<span class="variable">.lineWidth</span> = <span class="number">10</span>;</span><br><span class="line">    path<span class="variable">.lineJoinStyle</span> = k<span class="built_in">CGLineJoinRound</span>;</span><br><span class="line">    [path stroke];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="画板">画板</h2><ul>
<li>5.1、通过自动布局搭建界面</li>
</ul>
<p><img src="../images/屏幕快照 2015-06-22 10.30.13.png" alt=""></p>
<ul>
<li>5.2、在自定义view中得实现</li>
</ul>
<p><img src="../images/屏幕快照 2015-06-22 17.21.39.png" alt=""></p>
<ul>
<li>使用滑动手势进行画线</li>
<li>1、自定义一个继承自UIBezierPath 的类，用来改变线条的颜色，只需添加一个属性即可</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">drawPath</span> : <span class="title">UIBezierPath</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>2、自定义一个view封装画板的操作 DrawView</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line">@classdrawPath;</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DrawView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor; <span class="comment">// 线条颜色</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGFloat</span> lineWidth; <span class="comment">// 线条宽度</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UIImage</span> *image; <span class="comment">// 保存加载的图片</span></span><br><span class="line">- (<span class="keyword">void</span>)eraseScreen; <span class="comment">// 清屏</span></span><br><span class="line">- (<span class="keyword">void</span>)undo; <span class="comment">// 撤销</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>3、类扩展中添加两个属性</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"DrawView.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"drawPath.h"</span></span></span><br><span class="line">@interfaceDrawView ()</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) drawPath *path; <span class="comment">// 绘图路径</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *drawLines; <span class="comment">// 路径数组</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组懒加载</span></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)drawLines</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_drawLines == <span class="literal">nil</span>) &#123;</span><br><span class="line">        _drawLines = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  _drawLines;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>4、初始化方法</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setUp</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置手势</span></span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pan:)];</span><br><span class="line">    [selfaddGestureRecognizer:pan];</span><br><span class="line">    _lineColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    _lineWidth = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>5、手势实现</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)pan:(<span class="built_in">UIPanGestureRecognizer</span> *)pan</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取当前点</span></span><br><span class="line">    <span class="built_in">CGPoint</span> curPoint = [pan locationInView:<span class="keyword">self</span>];</span><br><span class="line">    <span class="keyword">if</span> (pan<span class="variable">.state</span> == <span class="built_in">UIGestureRecognizerStateBegan</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 设置起点</span></span><br><span class="line">        _path = [[drawPath alloc] init];</span><br><span class="line">        _path<span class="variable">.lineColor</span> = _lineColor;</span><br><span class="line">        _path<span class="variable">.lineWidth</span> = _lineWidth;</span><br><span class="line">        [_path moveToPoint:curPoint];</span><br><span class="line">        <span class="comment">// 保存路径</span></span><br><span class="line">        [<span class="keyword">self</span><span class="variable">.drawLines</span> addObject:_path];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    [_path addLineToPoint:curPoint];</span><br><span class="line">    <span class="comment">// 重绘</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>6、重写的构造方法</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xib调用</span></span><br><span class="line">- (<span class="keyword">void</span>)awakeFromNib</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> setUp];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 代码调用</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setUp];</span><br><span class="line">    &#125;</span><br><span class="line">    returnself;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>7、在drawRect 绘制图片</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清空屏幕</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (drawPath *path  <span class="keyword">in</span> <span class="keyword">self</span><span class="variable">.drawLines</span>) &#123;</span><br><span class="line">        <span class="comment">// 判断是不是图片</span></span><br><span class="line">        <span class="keyword">if</span> ([path isKindOfClass:[<span class="built_in">UIImage</span> class]]) &#123;</span><br><span class="line">            <span class="comment">// 绘制图片</span></span><br><span class="line">            <span class="built_in">UIImage</span> *image = (<span class="built_in">UIImage</span> *)path;</span><br><span class="line">            [image drawInRect:rect];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 不是图片就画线</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            [path<span class="variable">.lineColor</span> set];</span><br><span class="line">            [path stroke];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>8、其他方法实现</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清屏</span></span><br><span class="line">- (<span class="keyword">void</span>)eraseScreen</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.drawLines</span> removeAllObjects];</span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 撤销</span></span><br><span class="line">- (<span class="keyword">void</span>)undo</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.drawLines</span> removeLastObject];</span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// setter 方法，传入照片时进行刷新</span></span><br><span class="line">- (<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    _image = image;</span><br><span class="line">    <span class="comment">// 添加图片到绘图数组</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.drawLinesaddObject</span>:_image];</span><br><span class="line">    [selfsetNeedsDisplay];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>5.3、在控制器中实现</p>
</li>
<li><p>1、添加两个属性，imageView位于DrawView下面</p>
</li>
</ul>
<p><img src="../images/屏幕快照 2015-06-22 17.51.33.png" alt=""></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="keyword">IBOutlet</span> DrawView *drawView; <span class="comment">// 绘图面板</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *imageView; <span class="comment">// 加载的图片显示面板</span></span><br></pre></td></tr></table></figure>
<ul>
<li>2、工具栏:通过拖线的方式创建一个方法</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清屏</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)eraseScreen:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</span><br><span class="line">    [_drawView eraseScreen];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 撤销</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)undo:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    [_drawView undo];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 橡皮擦</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)eraser:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</span><br><span class="line">    <span class="keyword">if</span> ([sender<span class="variable">.title</span> isEqualToString:<span class="string">@"橡皮擦"</span>]) &#123;</span><br><span class="line">        sender<span class="variable">.title</span>  = <span class="string">@"绘图"</span>;</span><br><span class="line">        _drawView<span class="variable">.lineColor</span> = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        _drawView<span class="variable">.lineWidth</span> = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([sender<span class="variable">.title</span> isEqualToString:<span class="string">@"绘图"</span>]) &#123;</span><br><span class="line">        sender<span class="variable">.title</span>  = <span class="string">@"橡皮擦"</span>;</span><br><span class="line">        _drawView<span class="variable">.lineColor</span> = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        _drawView<span class="variable">.lineWidth</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存图片到相册</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)save:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">     <span class="comment">// 开启上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(<span class="keyword">self</span><span class="variable">.drawView</span><span class="variable">.bounds</span><span class="variable">.size</span>, <span class="literal">NO</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ref = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 渲染控制器到上下文</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.drawView</span><span class="variable">.layerrenderInContext</span>:ref];</span><br><span class="line">    <span class="built_in">UIImage</span> *image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="comment">// 关闭上下文</span></span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存画板的内容放入相册</span></span><br><span class="line">    <span class="comment">// image:写入的图片</span></span><br><span class="line">    <span class="comment">// completionTarget图片保存监听者</span></span><br><span class="line">    <span class="comment">// 注意：以后写入相册方法中，想要监听图片有没有保存完成，保存完成的方法不能随意乱写,必须传入这个方法didFinishSavingWithError</span></span><br><span class="line">    <span class="built_in">UIImageWriteToSavedPhotosAlbum</span>(image, <span class="keyword">self</span>, <span class="keyword">@selector</span>(image:didFinishSavingWithError:contextInfo:), <span class="literal">nil</span>);</span><br><span class="line">    <span class="comment">// 保存到桌面</span></span><br><span class="line"><span class="comment">//    NSData *data = UIImagePNGRepresentation(image);</span></span><br><span class="line"><span class="comment">//    [data writeToFile:@"/Users/song/Desktop/sss.png" atomically:YES];</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 监听保存完成，必须实现这个方法</span></span><br><span class="line">- (<span class="keyword">void</span>)image: (<span class="built_in">UIImage</span> *) image didFinishSavingWithError: (<span class="built_in">NSError</span> *) error contextInfo: (<span class="keyword">void</span> *) contextInfo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"图片保存成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>3、加载图片：图片控制器</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从相册加载一张图片</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)photo:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 初始化图片控制器</span></span><br><span class="line">    <span class="built_in">UIImagePickerController</span> *pick = [[<span class="built_in">UIImagePickerController</span> alloc] init];</span><br><span class="line">    <span class="comment">// 设置路径</span></span><br><span class="line">    <span class="comment">// 设置选择控制器的来源</span></span><br><span class="line">    <span class="comment">// UIImagePickerControllerSourceTypePhotoLibrary 相册集</span></span><br><span class="line">    <span class="comment">// UIImagePickerControllerSourceTypeSavedPhotosAlbum:照片库</span></span><br><span class="line">    pick<span class="variable">.sourceType</span> = <span class="built_in">UIImagePickerControllerSourceTypeSavedPhotosAlbum</span>;</span><br><span class="line">    <span class="comment">// 设置代理</span></span><br><span class="line">    pick<span class="variable">.delegate</span> = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// modal 方式弹出图片控制器</span></span><br><span class="line">    [selfpresentViewController:pick animated:YEScompletion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 图片代理</span></span><br><span class="line">- (<span class="keyword">void</span>)imagePickerController:(<span class="built_in">UIImagePickerController</span> *)picker didFinishPickingMediaWithInfo:(<span class="built_in">NSDictionary</span> *)info</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取选中的图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = info[<span class="string">@"UIImagePickerControllerOriginalImage"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,image);</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.alpha</span> = <span class="number">1</span>; <span class="comment">// 可见</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.userInteractionEnabled</span> = <span class="literal">YES</span>; <span class="comment">// 设置交互</span></span><br><span class="line">    <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.image</span> = image;</span><br><span class="line">    [<span class="keyword">self</span> addGestures]; <span class="comment">// 添加手势</span></span><br><span class="line">    <span class="comment">// 退出控制器</span></span><br><span class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion: <span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>4、添加各种手势</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addGestures</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 滑动</span></span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pan:)];</span><br><span class="line">     pan<span class="variable">.delegate</span> = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.imageViewaddGestureRecognizer</span>:pan];</span><br><span class="line">    <span class="comment">// 旋转</span></span><br><span class="line">    <span class="built_in">UIRotationGestureRecognizer</span> *rotate = [[<span class="built_in">UIRotationGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(rotate:)];</span><br><span class="line">    rotate<span class="variable">.delegate</span> = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.imageViewaddGestureRecognizer</span>:rotate];</span><br><span class="line">    <span class="comment">// 捏合</span></span><br><span class="line">    <span class="built_in">UIPinchGestureRecognizer</span> *pinch = [[<span class="built_in">UIPinchGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pinch:)];</span><br><span class="line">    pinch<span class="variable">.delegate</span> = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.imageViewaddGestureRecognizer</span>:pinch];</span><br><span class="line">    <span class="comment">// 长按</span></span><br><span class="line">    <span class="built_in">UILongPressGestureRecognizer</span> *lPress = [[<span class="built_in">UILongPressGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(lPress:)];</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.imageViewaddGestureRecognizer</span>:lPress];</span><br><span class="line">    <span class="comment">// 点按</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(tap:)];</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.imageViewaddGestureRecognizer</span>:tap];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 同一时刻运行响应多个手势</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)gestureRecognizer:(<span class="built_in">UIGestureRecognizer</span> *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(<span class="built_in">UIGestureRecognizer</span> *)otherGestureRecognizer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)pan:(<span class="built_in">UIPanGestureRecognizer</span> *)pan</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> curP = [pan translationInView:<span class="keyword">self</span><span class="variable">.imageView</span>];</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.transform</span> = <span class="built_in">CGAffineTransformTranslate</span>(<span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.transform</span>, curP<span class="variable">.x</span>, curP<span class="variable">.y</span>);</span><br><span class="line">    <span class="comment">// 复位</span></span><br><span class="line">    [pan setTranslation:<span class="built_in">CGPointZeroinView</span>:<span class="keyword">self</span><span class="variable">.imageView</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)pinch:(<span class="built_in">UIPinchGestureRecognizer</span> *)pinch</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> scale = pinch<span class="variable">.scale</span>;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.transform</span> = <span class="built_in">CGAffineTransformScale</span>(<span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.transform</span>, scale, scale);</span><br><span class="line">    <span class="comment">// 复位</span></span><br><span class="line">    pinch<span class="variable">.scale</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)tap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)lPress:(<span class="built_in">UILongPressGestureRecognizer</span> *)lPress</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 截取图片到绘图面板</span></span><br><span class="line">    <span class="keyword">if</span> (lPress<span class="variable">.state</span> == <span class="built_in">UIGestureRecognizerStateBegan</span>)  &#123;</span><br><span class="line">         [<span class="built_in">UIViewanimateWithDuration</span>:<span class="number">0.25</span>animations:^&#123;</span><br><span class="line">             <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.alpha</span> = <span class="number">0.5</span>;</span><br><span class="line">         &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            [<span class="built_in">UIViewanimateWithDuration</span>:<span class="number">0.25</span>animations:^&#123;</span><br><span class="line">                <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.alpha</span> = <span class="number">1</span>;</span><br><span class="line">            &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">                <span class="comment">// 截屏,使用之前定义的分类，包含头文件即可使用</span></span><br><span class="line">                <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithSnipView:<span class="keyword">self</span><span class="variable">.drawView</span>];</span><br><span class="line">                <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.alpha</span> = <span class="number">0</span>;</span><br><span class="line">                _drawView<span class="variable">.image</span> = image; <span class="comment">// 显示图片到绘图面板</span></span><br><span class="line">            &#125;];</span><br><span class="line">         &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)rotate:(<span class="built_in">UIRotationGestureRecognizer</span> *)rotate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> rotation = rotate<span class="variable">.rotation</span>;</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.transform</span> = <span class="built_in">CGAffineTransformRotate</span>(<span class="keyword">self</span><span class="variable">.imageView</span><span class="variable">.transform</span>, rotation);</span><br><span class="line">    <span class="comment">// 复位</span></span><br><span class="line">    rotate<span class="variable">.rotation</span> = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>5、线条颜色和宽度设置</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)colorChange:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    _drawView<span class="variable">.lineColor</span> = sender<span class="variable">.backgroundColor</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">IBAction</span>)valueChange:(<span class="built_in">UISlider</span> *)sender &#123;</span><br><span class="line">    _drawView<span class="variable">.lineWidth</span> = sender<span class="variable">.value</span> * <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>效果</li>
</ul>
<p><img src="../images/画板.gif" alt=""></p>
<p><a href="http://www.cnblogs.com/songliquan/" target="_blank" rel="external">http://www.cnblogs.com/songliquan/</a></p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/iOS/">iOS</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2013/05/23/Quartz2D-绘图/" data-title="Quartz2D-绘图 | Bloging" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2013/05/26/源代码管理/" title="源代码管理工具">
  <strong>PREVIOUS:</strong><br/>
  <span>
  源代码管理工具</span>
</a>
</div>


<div class="next">
<a href="/2013/05/16/运行时-关联/"  title="运行时关联">
 <strong>NEXT:</strong><br/> 
 <span>运行时关联
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Quartz2D-绘图"><span class="toc-number">1.</span> <span class="toc-text">Quartz2D-绘图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#几种简单的绘图方式"><span class="toc-number">1.2.</span> <span class="toc-text">几种简单的绘图方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文本显示"><span class="toc-number">1.3.</span> <span class="toc-text">文本显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#富文本显示"><span class="toc-number">1.4.</span> <span class="toc-text">富文本显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#绘制图片到视图"><span class="toc-number">1.5.</span> <span class="toc-text">绘制图片到视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#绘图刷新-定时器"><span class="toc-number">1.6.</span> <span class="toc-text">绘图刷新-定时器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#矩阵操作"><span class="toc-number">1.7.</span> <span class="toc-text">矩阵操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#水印处理"><span class="toc-number">1.8.</span> <span class="toc-text">水印处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图形裁切"><span class="toc-number">1.9.</span> <span class="toc-text">图形裁切</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#屏幕截图"><span class="toc-number">1.10.</span> <span class="toc-text">屏幕截图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手势解锁"><span class="toc-number">1.11.</span> <span class="toc-text">手势解锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#画板"><span class="toc-number">1.12.</span> <span class="toc-text">画板</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/HTML5/" title="HTML5">HTML5<sup>1</sup></a></li>
		
			<li><a href="/tags/autolayout/" title="autolayout">autolayout<sup>1</sup></a></li>
		
			<li><a href="/tags/iOS/" title="iOS">iOS<sup>21</sup></a></li>
		
			<li><a href="/tags/iPad/" title="iPad">iPad<sup>1</sup></a></li>
		
			<li><a href="/tags/scrollView/" title="scrollView">scrollView<sup>1</sup></a></li>
		
			<li><a href="/tags/换肤/" title="换肤">换肤<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="Mr Song">Mr Song</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
