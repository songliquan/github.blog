
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>正则表达式 | Bloging</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Mr Song">
    

    
    <meta name="description" content="正则表达式
正则表达式是对字符串操作的一种逻辑公式，用事先定义好的一些特定字符、及这些特定字符的组合，组成一个”规则字符串”，这个”规则字符串”用来表达对字符串的一种过滤逻辑。

正则表达式的用处:

判断给定的字符串是否符合某一种规则(专门用于操作字符串)
电话号码，电子邮箱，URL…
可以直接百度别人写好的正则
别人真的写好了，而且测试过了，我们可以直接用
要写出没有漏洞正则判断，需要大量的测">
<meta property="og:type" content="article">
<meta property="og:title" content="正则表达式">
<meta property="og:url" content="http://yoursite.com/2015/10/04/正则表达式/index.html">
<meta property="og:site_name" content="Bloging">
<meta property="og:description" content="正则表达式
正则表达式是对字符串操作的一种逻辑公式，用事先定义好的一些特定字符、及这些特定字符的组合，组成一个”规则字符串”，这个”规则字符串”用来表达对字符串的一种过滤逻辑。

正则表达式的用处:

判断给定的字符串是否符合某一种规则(专门用于操作字符串)
电话号码，电子邮箱，URL…
可以直接百度别人写好的正则
别人真的写好了，而且测试过了，我们可以直接用
要写出没有漏洞正则判断，需要大量的测">
<meta property="og:updated_time" content="2015-10-05T14:09:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="正则表达式">
<meta name="twitter:description" content="正则表达式
正则表达式是对字符串操作的一种逻辑公式，用事先定义好的一些特定字符、及这些特定字符的组合，组成一个”规则字符串”，这个”规则字符串”用来表达对字符串的一种过滤逻辑。

正则表达式的用处:

判断给定的字符串是否符合某一种规则(专门用于操作字符串)
电话号码，电子邮箱，URL…
可以直接百度别人写好的正则
别人真的写好了，而且测试过了，我们可以直接用
要写出没有漏洞正则判断，需要大量的测">

    
    <link rel="alternative" href="/atom.xml" title="Bloging" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Bloging" title="Bloging"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Bloging">Bloging</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/Categories">Categories</a></li>
					
						<li><a href="/Archives">Archives</a></li>
					
						<li><a href="/Tags">Tags</a></li>
					
						<li><a href="/About">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/04/正则表达式/" title="正则表达式" itemprop="url">正则表达式</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mr Song" target="_blank" itemprop="author">Mr Song</a>
		
  <p class="article-time">
    <time datetime="2015-10-04T02:25:18.000Z" itemprop="datePublished"> 发表于 2015-10-04</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#正则表达式"><span class="toc-number">1.</span> <span class="toc-text">正则表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#正则表达式的用处:"><span class="toc-number">1.1.</span> <span class="toc-text">正则表达式的用处:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语法规则"><span class="toc-number">1.2.</span> <span class="toc-text">语法规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用过程"><span class="toc-number">1.3.</span> <span class="toc-text">使用过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码示例"><span class="toc-number">1.4.</span> <span class="toc-text">代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用子类来匹配日期、地址、和URL"><span class="toc-number">1.5.</span> <span class="toc-text">使用子类来匹配日期、地址、和URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TextKit_给URL高亮显示"><span class="toc-number">1.6.</span> <span class="toc-text">TextKit 给URL高亮显示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义UILabel来实现url高亮"><span class="toc-number">1.6.1.</span> <span class="toc-text">自定义UILabel来实现url高亮</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取label中URL的点击"><span class="toc-number">1.6.2.</span> <span class="toc-text">获取label中URL的点击</span></a></li></ol></li></ol></li></ol>
		
		</div>
		
		<h1 id="正则表达式">正则表达式</h1><ul>
<li>正则表达式是对字符串操作的一种逻辑公式，用事先定义好的一些特定字符、及这些特定字符的组合，组成一个”规则字符串”，这个”规则字符串”用来表达对字符串的一种过滤逻辑。</li>
</ul>
<h2 id="正则表达式的用处:">正则表达式的用处:</h2><ul>
<li><ol>
<li>判断给定的字符串是否符合某一种规则(专门用于操作字符串)<ul>
<li>电话号码，电子邮箱，URL…</li>
<li>可以直接百度别人写好的正则</li>
<li>别人真的写好了，而且测试过了，我们可以直接用</li>
<li>要写出没有漏洞正则判断，需要大量的测试，通常最终结果非常负责</li>
</ul>
</li>
</ol>
</li>
<li><ol>
<li>过滤筛选字符串，网络爬虫</li>
</ol>
</li>
<li><ol>
<li>替换文字，QQ聊天，图文混排</li>
</ol>
</li>
</ul>
<h2 id="语法规则">语法规则</h2><ul>
<li>1&gt;    集合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[xyz]&#9;&#9;&#23383;&#31526;&#38598;&#21512;(x/y&#25110;z)&#10;[a-z]&#9;&#9;&#23383;&#31526;&#33539;&#22260;&#10;[a-zA-Z]&#10;[^xyz]&#9;&#9;&#36127;&#20540;&#23383;&#31526;&#38598;&#21512; (&#20219;&#20309;&#23383;&#31526;, &#38500;&#20102;xyz)&#10;[^a-z]&#9;&#9;&#36127;&#20540;&#23383;&#31526;&#33539;&#22260;&#10;[a-d][m-p]  &#24182;&#38598;(a&#21040;d &#25110; m&#21040;p)</span><br></pre></td></tr></table></figure>
<ul>
<li>2&gt;    常用元字符</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#9;&#9;&#9;&#21305;&#37197;&#38500;&#25442;&#34892;&#31526;&#20197;&#22806;&#30340;&#20219;&#24847;&#23383;&#31526;&#10;\w&#9;&#9;&#9;&#21305;&#37197;&#23383;&#27597;&#25110;&#25968;&#23383;&#25110;&#19979;&#21010;&#32447;&#25110;&#27721;&#23383; [a-zA-Z_0-9]&#10;\s&#9;&#9;&#9;&#21305;&#37197;&#20219;&#24847;&#30340;&#31354;&#30333;&#31526;&#65288;&#31354;&#26684;&#12289;TAB\t&#12289;&#22238;&#36710;\r \n&#65289;&#10;\d&#9;&#9;&#9;&#21305;&#37197;&#25968;&#23383; [0-9]&#10;^&#9;&#9;&#9;&#21305;&#37197;&#23383;&#31526;&#20018;&#30340;&#24320;&#22987;&#10;$&#9;&#9;&#9;&#21305;&#37197;&#23383;&#31526;&#20018;&#30340;&#32467;&#26463;&#10;\b&#9;&#9;&#9;&#21305;&#37197;&#21333;&#35789;&#30340;&#24320;&#22987;&#25110;&#32467;&#26463;</span><br></pre></td></tr></table></figure>
<ul>
<li>2&gt;    常用反义符</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\W          &#21305;&#37197;&#20219;&#24847;&#19981;&#26159;&#23383;&#27597;&#65292;&#25968;&#23383;&#65292;&#19979;&#21010;&#32447;&#65292;&#27721;&#23383;&#30340;&#23383;&#31526;[^\w]&#10;\S&#9;&#9;&#9;&#21305;&#37197;&#20219;&#24847;&#19981;&#26159;&#31354;&#30333;&#31526;&#30340;&#23383;&#31526; [^\s]&#10;\D&#9;&#9;&#9;&#21305;&#37197;&#20219;&#24847;&#38750;&#25968;&#23383;&#30340;&#23383;&#31526;[^0-9]&#10;\B&#9;&#9;&#9;&#21305;&#37197;&#19981;&#26159;&#21333;&#35789;&#24320;&#22836;&#25110;&#32467;&#26463;&#30340;&#20301;&#32622;&#10;[^x]&#9;&#9;&#21305;&#37197;&#38500;&#20102;x&#20197;&#22806;&#30340;&#20219;&#24847;&#23383;&#31526;&#10;[^aeiou]&#9;&#21305;&#37197;&#38500;&#20102;aeiou&#36825;&#20960;&#20010;&#23383;&#27597;&#20197;&#22806;&#30340;&#20219;&#24847;&#23383;&#31526;</span><br></pre></td></tr></table></figure>
<ul>
<li>4&gt;    常用限定符</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*&#9;&#9;&#9;&#37325;&#22797;&#38646;&#27425;&#25110;&#26356;&#22810;&#27425;&#10;+&#9;&#9;&#9;&#37325;&#22797;&#19968;&#27425;&#25110;&#26356;&#22810;&#27425;&#10;?&#9;&#9;&#9;&#37325;&#22797;&#38646;&#27425;&#25110;&#19968;&#27425;&#10;&#123;n&#125;&#9;&#9;&#9;&#37325;&#22797;n&#27425;&#10;&#123;n,&#125;&#9;&#9;&#37325;&#22797;n&#27425;&#25110;&#26356;&#22810;&#27425;&#10;&#123;n,m&#125;&#9;&#9;&#37325;&#22797;n&#21040;m&#27425;,</span><br></pre></td></tr></table></figure>
<ul>
<li>5&gt;    贪婪和懒惰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*?&#9;&#9;&#9;&#37325;&#22797;&#20219;&#24847;&#27425;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797;&#10;*+&#9;&#9;&#9;&#37325;&#22797;1&#27425;&#25110;&#26356;&#22810;&#27425;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797;&#10;??&#9;&#9;&#9;&#37325;&#22797;0&#27425;&#25110;1&#27425;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797;&#10;&#123;n,m&#125;?      &#37325;&#22797;n&#21040;m&#27425;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797;&#10;&#123;n,&#125;?&#9;&#9;&#37325;&#22797;n&#27425;&#20197;&#19978;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797;</span><br></pre></td></tr></table></figure>
<h2 id="使用过程">使用过程</h2><ul>
<li>1、创建规则</li>
<li>2、创建正则表达式对象</li>
<li>3、开始匹配</li>
</ul>
<h2 id="代码示例">代码示例</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">private <span class="func"><span class="keyword">func</span> <span class="title">check</span><span class="params">(str: String)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 使用正则表达式一定要加try语句</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// - 1、创建规则</span></span><br><span class="line">        <span class="keyword">let</span> pattern = <span class="string">"[1-9][0-9]&#123;4,14&#125;"</span></span><br><span class="line">        <span class="comment">// - 2、创建正则表达式对象</span></span><br><span class="line">        <span class="keyword">let</span> regex = try <span class="type">NSRegularExpression</span>(pattern: pattern, options: <span class="type">NSRegularExpressionOptions</span>.<span class="type">CaseInsensitive</span>)</span><br><span class="line">        <span class="comment">// - 3、开始匹配</span></span><br><span class="line">        <span class="keyword">let</span> res = regex.matchesInString(str, options: <span class="type">NSMatchingOptions</span>(rawValue: <span class="number">0</span>), range: <span class="type">NSMakeRange</span>(<span class="number">0</span>, str.characters.<span class="built_in">count</span>))</span><br><span class="line">        <span class="comment">// 输出结果</span></span><br><span class="line">        <span class="keyword">for</span> checkingRes <span class="keyword">in</span> res &#123;</span><br><span class="line">            <span class="built_in">print</span>((str <span class="keyword">as</span> <span class="type">NSString</span>).substringWithRange(checkingRes.range))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    catch &#123;</span><br><span class="line">        <span class="built_in">print</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>其他几个常用方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// &#21305;&#37197;&#23383;&#31526;&#20018;&#20013;&#25152;&#26377;&#30340;&#31526;&#21512;&#35268;&#21017;&#30340;&#23383;&#31526;&#20018;, &#36820;&#22238;&#21305;&#37197;&#21040;&#30340;NSTextCheckingResult&#25968;&#32452;&#10;public func matchesInString(string: String, options: NSMatchingOptions, range: NSRange) -&#62; [NSTextCheckingResult]&#10;&#10;// &#25353;&#29031;&#35268;&#21017;&#21305;&#37197;&#23383;&#31526;&#20018;, &#36820;&#22238;&#21305;&#37197;&#21040;&#30340;&#20010;&#25968;&#10;public func numberOfMatchesInString(string: String, options: NSMatchingOptions, range: NSRange) -&#62; Int&#10;&#10;// &#25353;&#29031;&#35268;&#21017;&#21305;&#37197;&#23383;&#31526;&#20018;, &#36820;&#22238;&#31532;&#19968;&#20010;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;&#30340;NSTextCheckingResult&#10;public func firstMatchInString(string: String, options: NSMatchingOptions, range: NSRange) -&#62; NSTextCheckingResult?&#10;&#10;// &#25353;&#29031;&#35268;&#21017;&#21305;&#37197;&#23383;&#31526;&#20018;, &#36820;&#22238;&#31532;&#19968;&#20010;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;&#30340;&#33539;&#22260;&#10;public func rangeOfFirstMatchInString(string: String, options: NSMatchingOptions, range: NSRange) -&#62; NSRange</span><br></pre></td></tr></table></figure>
<h2 id="使用子类来匹配日期、地址、和URL">使用子类来匹配日期、地址、和URL</h2><ul>
<li>看官网文档解释，可以知道这个<code>NSDataDetector</code>主要用来匹配日期、地址、和URL。在使用时指定要匹配的类型</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">NSDataDetector</span> : <span class="title">NSRegularExpression</span> </span>&#123;</span><br><span class="line">    <span class="comment">// all instance variables are private</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* NSDataDetector is a specialized subclass of NSRegularExpression.  Instead of finding matches to regular expression patterns, it matches items identified by Data Detectors, such as dates, addresses, and URLs.  The checkingTypes argument should contain one or more of the types NSTextCheckingTypeDate, NSTextCheckingTypeAddress, NSTextCheckingTypeLink, NSTextCheckingTypePhoneNumber, and NSTextCheckingTypeTransitInformation.  The NSTextCheckingResult instances returned will be of the appropriate types from that list.</span><br><span class="line">    */</span></span><br><span class="line">    </span><br><span class="line">    public <span class="keyword">init</span>(types checkingTypes: <span class="type">NSTextCheckingTypes</span>) throws</span><br><span class="line">    </span><br><span class="line">    public <span class="keyword">var</span> checkingTypes: <span class="type">NSTextCheckingTypes</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个是类型选择</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">Date</span>: <span class="type">NSTextCheckingType</span> &#123; <span class="keyword">get</span> &#125; <span class="comment">// date/time detection</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">Address</span>: <span class="type">NSTextCheckingType</span> &#123; <span class="keyword">get</span> &#125; <span class="comment">// address detection</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">Link</span>: <span class="type">NSTextCheckingType</span> &#123; <span class="keyword">get</span> &#125; <span class="comment">// link detection</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>NSDataDetector</code> 获取URL示例</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">匹配字符串中的URLS</span><br><span class="line">- parameter str: 要匹配的字符串</span><br><span class="line">*/</span></span><br><span class="line">private <span class="func"><span class="keyword">func</span> <span class="title">getUrl</span><span class="params">(str:String)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 创建一个正则表达式对象</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> dataDetector = try <span class="type">NSDataDetector</span>(types: <span class="type">NSTextCheckingTypes</span>(<span class="type">NSTextCheckingType</span>.<span class="type">Link</span>.rawValue))</span><br><span class="line">        <span class="comment">// 匹配字符串，返回结果集</span></span><br><span class="line">        <span class="keyword">let</span> res = dataDetector.matchesInString(str, options: <span class="type">NSMatchingOptions</span>(rawValue: <span class="number">0</span>), range: <span class="type">NSMakeRange</span>(<span class="number">0</span>, str.characters.<span class="built_in">count</span>))</span><br><span class="line">        <span class="comment">// 取出结果</span></span><br><span class="line">        <span class="keyword">for</span> checkingRes <span class="keyword">in</span> res &#123;</span><br><span class="line">            <span class="built_in">print</span>((str <span class="keyword">as</span> <span class="type">NSString</span>).substringWithRange(checkingRes.range))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    catch &#123;</span><br><span class="line">        <span class="built_in">print</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>“.*?” 可以满足一些基本的匹配要求</li>
<li>如果想同时匹配多个规则 ，可以通过 “|” 将多个规则连接起来</li>
<li>将字符串中文字替换为表情</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">显示字符中的表情</span><br><span class="line">- parameter str: 匹配字符串</span><br><span class="line">*/</span></span><br><span class="line">private <span class="func"><span class="keyword">func</span> <span class="title">getEmoji</span><span class="params">(str:String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> strM = <span class="type">NSMutableAttributedString</span>(string: str)</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pattern = <span class="string">"\\[.*?\\]"</span></span><br><span class="line">        <span class="keyword">let</span> regex = try <span class="type">NSRegularExpression</span>(pattern: pattern, options: <span class="type">NSRegularExpressionOptions</span>.<span class="type">CaseInsensitive</span>)</span><br><span class="line">        <span class="keyword">let</span> res = regex.matchesInString(str, options: <span class="type">NSMatchingOptions</span>(rawValue: <span class="number">0</span>), range: <span class="type">NSMakeRange</span>(<span class="number">0</span>, str.characters.<span class="built_in">count</span>))</span><br><span class="line">        <span class="keyword">var</span> <span class="built_in">count</span> = res.<span class="built_in">count</span></span><br><span class="line">        <span class="comment">// 反向取出文字表情</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> checkingRes = res[--<span class="built_in">count</span>]</span><br><span class="line">            <span class="keyword">let</span> tempStr = (str <span class="keyword">as</span> <span class="type">NSString</span>).substringWithRange(checkingRes.range)</span><br><span class="line">            <span class="comment">// 转换字符串到表情</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> emoticon  = <span class="type">EmoticonPackage</span>.emoticonWithStr(tempStr) &#123;</span><br><span class="line">                <span class="built_in">print</span>(emoticon.chs)</span><br><span class="line">                <span class="keyword">let</span> attrStr = <span class="type">EmoticonTextAttachment</span>.imageText(emoticon, font: <span class="number">18</span>)</span><br><span class="line">                strM.replaceCharactersInRange(checkingRes.range, withAttributedString: attrStr)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(strM)</span><br><span class="line">        <span class="comment">// 替换字符串,显示到label</span></span><br><span class="line">        emoticonLabel.attributedText = strM</span><br><span class="line">    &#125;</span><br><span class="line">    catch &#123;</span><br><span class="line">        <span class="built_in">print</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="TextKit_给URL高亮显示"><code>TextKit</code> 给URL高亮显示</h2><ul>
<li>主要用到三个类</li>
<li><code>NSTextStorage</code></li>
<li><code>NSLayoutManager</code></li>
<li><code>NSTextContainer</code></li>
</ul>
<h3 id="自定义UILabel来实现url高亮">自定义UILabel来实现url高亮</h3><ul>
<li>1、定义要用到的属性</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">  只要textStorage中的内容发生变化, 就可以通知layoutManager重新布局</span><br><span class="line">  layoutManager重新布局需要知道绘制到什么地方, 所以layoutManager就会文textContainer绘制的区域</span><br><span class="line">  */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 准们用于存储内容的</span></span><br><span class="line">  <span class="comment">// textStorage 中有 layoutManager</span></span><br><span class="line">  private lazy <span class="keyword">var</span> textStorage = <span class="type">NSTextStorage</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 专门用于管理布局</span></span><br><span class="line">  <span class="comment">// layoutManager 中有 textContainer</span></span><br><span class="line">  private lazy <span class="keyword">var</span> layoutManager = <span class="type">NSLayoutManager</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 专门用于指定绘制的区域</span></span><br><span class="line">  private lazy <span class="keyword">var</span> textContainer = <span class="type">NSTextContainer</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">      <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">      setupSystem()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  required <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">      <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">      setupSystem()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  private <span class="func"><span class="keyword">func</span> <span class="title">setupSystem</span><span class="params">()</span></span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">// 1.将layoutManager添加到textStorage</span></span><br><span class="line">      textStorage.addLayoutManager(layoutManager)</span><br><span class="line">      <span class="comment">// 2.将textContainer添加到layoutManager</span></span><br><span class="line">      layoutManager.addTextContainer(textContainer)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line"> 		 <span class="keyword">super</span>.layoutSubviews()</span><br><span class="line">  	 <span class="comment">// 3.指定区域</span></span><br><span class="line"> 		 textContainer.size = bounds.size</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>2、重写label的text属性</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">override</span> <span class="keyword">var</span> text: <span class="type">String</span>?</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="comment">// 1.修改textStorage存储的内容</span></span><br><span class="line">        textStorage.setAttributedString(<span class="type">NSAttributedString</span>(string: text!))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.设置textStorage的属性</span></span><br><span class="line">        textStorage.addAttribute(<span class="type">NSFontAttributeName</span>, value: <span class="type">UIFont</span>.systemFontOfSize(<span class="number">20</span>), range: <span class="type">NSMakeRange</span>(<span class="number">0</span>, text!.characters.<span class="built_in">count</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3.处理URL</span></span><br><span class="line">        <span class="keyword">self</span>.<span class="type">URLRegex</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.通知layoutManager重新布局</span></span><br><span class="line">        setNeedsDisplay()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>3、匹配字符串</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">URLRegex</span><span class="params">()</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.创建一个正则表达式对象</span></span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> dataDetector = try <span class="type">NSDataDetector</span>(types: <span class="type">NSTextCheckingTypes</span>(<span class="type">NSTextCheckingType</span>.<span class="type">Link</span>.rawValue))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> res =  dataDetector.matchesInString(textStorage.string, options: <span class="type">NSMatchingOptions</span>(rawValue: <span class="number">0</span>), range: <span class="type">NSMakeRange</span>(<span class="number">0</span>, textStorage.string.characters.<span class="built_in">count</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4取出结果</span></span><br><span class="line">            <span class="keyword">for</span> checkingRes <span class="keyword">in</span> res</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">let</span> str = (textStorage.string <span class="keyword">as</span> <span class="type">NSString</span>).substringWithRange(checkingRes.range)</span><br><span class="line">                <span class="keyword">let</span> tempStr = <span class="type">NSMutableAttributedString</span>(string: str)</span><br><span class="line">                </span><br><span class="line"><span class="comment">//                tempStr.addAttribute(NSForegroundColorAttributeName, value: UIColor.redColor(), range: NSMakeRange(0, str.characters.count))</span></span><br><span class="line">                tempStr.addAttributes([<span class="type">NSFontAttributeName</span>: <span class="type">UIFont</span>.systemFontOfSize(<span class="number">20</span>), <span class="type">NSForegroundColorAttributeName</span>: <span class="type">UIColor</span>.redColor()], range: <span class="type">NSMakeRange</span>(<span class="number">0</span>, str.characters.<span class="built_in">count</span>))</span><br><span class="line">                </span><br><span class="line">                textStorage.replaceCharactersInRange(checkingRes.range, withAttributedString: tempStr)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;catch</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>4、重绘文字</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 如果是UILabel调用setNeedsDisplay方法, 系统会促发drawTextInRect</span></span><br><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">drawTextInRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 重绘</span></span><br><span class="line">    <span class="comment">// 字形 : 理解为一个小的UIView</span></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    第一个参数: 指定绘制的范围</span><br><span class="line">    第二个参数: 指定从什么位置开始绘制</span><br><span class="line">    */</span></span><br><span class="line">    layoutManager.drawGlyphsForGlyphRange(<span class="type">NSMakeRange</span>(<span class="number">0</span>, text!.characters.<span class="built_in">count</span>), atPoint: <span class="type">CGPointZero</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取label中URL的点击">获取label中URL的点击</h3><ul>
<li>如果要获取URL的点击，那么必须获取点击的范围</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">     <span class="comment">// 1、获取手指点击的位置</span></span><br><span class="line">     <span class="keyword">let</span> touch = (touches <span class="keyword">as</span> <span class="type">NSSet</span>).anyObject()!</span><br><span class="line">     <span class="keyword">let</span> point = touch.locationInView(touch.view)</span><br><span class="line">     <span class="built_in">print</span>(point)</span><br><span class="line">     <span class="comment">// 2、获取URL区域</span></span><br><span class="line">     <span class="comment">// 注意: 没有办法直接设置UITextRange的范围</span></span><br><span class="line">     <span class="keyword">let</span> range = <span class="type">NSMakeRange</span>(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">     <span class="comment">// 只要设置selectedRange, 那么就相当于设置了selectedTextRange</span></span><br><span class="line">     selectedRange = range</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// 给定指定的range, 返回range对应的字符串的rect</span></span><br><span class="line">     <span class="comment">// 返回数组的原因是因为文字可能换行</span></span><br><span class="line">     <span class="keyword">let</span> array = selectionRectsForRange(selectedTextRange!)</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">for</span> selectionRect <span class="keyword">in</span> array &#123;</span><br><span class="line">         <span class="keyword">if</span> <span class="type">CGRectContainsPoint</span>(selectionRect.rect, point) &#123;</span><br><span class="line">             <span class="built_in">print</span>(<span class="string">"点击了URL"</span>)</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/swift/">swift</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2015/10/04/正则表达式/" data-title="正则表达式 | Bloging" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/10/06/数据库应用/" title="数据库应用">
  <strong>上一篇：</strong><br/>
  <span>
  数据库应用</span>
</a>
</div>


<div class="next">
<a href="/2015/10/02/swift坑-tableView中注册cell/"  title="swift坑-tableView中注册cell">
 <strong>下一篇：</strong><br/> 
 <span>swift坑-tableView中注册cell
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/10/04/正则表达式/" data-title="正则表达式" data-url="http://yoursite.com/2015/10/04/正则表达式/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#正则表达式"><span class="toc-number">1.</span> <span class="toc-text">正则表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#正则表达式的用处:"><span class="toc-number">1.1.</span> <span class="toc-text">正则表达式的用处:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语法规则"><span class="toc-number">1.2.</span> <span class="toc-text">语法规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用过程"><span class="toc-number">1.3.</span> <span class="toc-text">使用过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码示例"><span class="toc-number">1.4.</span> <span class="toc-text">代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用子类来匹配日期、地址、和URL"><span class="toc-number">1.5.</span> <span class="toc-text">使用子类来匹配日期、地址、和URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TextKit_给URL高亮显示"><span class="toc-number">1.6.</span> <span class="toc-text">TextKit 给URL高亮显示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义UILabel来实现url高亮"><span class="toc-number">1.6.1.</span> <span class="toc-text">自定义UILabel来实现url高亮</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取label中URL的点击"><span class="toc-number">1.6.2.</span> <span class="toc-text">获取label中URL的点击</span></a></li></ol></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/OC/" title="OC">OC<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/swift/" title="swift">swift<sup>5</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> This is my blog,believe it or not. <br/>
			To be or not to be, this is the question.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1728379850" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/slq0378" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/5396469" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		
		<a href="https://www.facebook.com/song.liquan" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		<a href="http://www.zhihu.com/people/song88" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:slq0378@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="Mr Song">Mr Song</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"Song"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-68091434-1', 'auto');  
ga('send', 'pageview');
</script>



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
